
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Init System · Kent的博客</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-page-treeview/style.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-sidebar-style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-auto-scroll-table/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-click-reveal/click_reveal.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-pageview-count/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="startAPP.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../0_图形系统/">
            
                <a href="../../0_图形系统/">
            
                    
                    0_图形系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../0_图形系统/0_Graphic系统总论/0_Graphic系统总论.html">
            
                <a href="../../0_图形系统/0_Graphic系统总论/0_Graphic系统总论.html">
            
                    
                    0_Graphic系统总论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../0_图形系统/1_Render系统/">
            
                <a href="../../0_图形系统/1_Render系统/">
            
                    
                    1_Render系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../0_图形系统/1_Render系统/opengl.html">
            
                <a href="../../0_图形系统/1_Render系统/opengl.html">
            
                    
                    Opengl
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../0_图形系统/3_Display系统/">
            
                <a href="../../0_图形系统/3_Display系统/">
            
                    
                    3_Display系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../0_图形系统/3_Display系统/Display系统.html">
            
                <a href="../../0_图形系统/3_Display系统/Display系统.html">
            
                    
                    Display系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../0_图形系统/3_Display系统/sf特效.html">
            
                <a href="../../0_图形系统/3_Display系统/sf特效.html">
            
                    
                    sf特效
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../0_图形系统/3_Display系统/合成器surfaceFlinger.html">
            
                <a href="../../0_图形系统/3_Display系统/合成器surfaceFlinger.html">
            
                    
                    合成器surfaceFlinger
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../../0_图形系统/其他/">
            
                <a href="../../0_图形系统/其他/">
            
                    
                    其他
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.4.1" data-path="../../0_图形系统/其他/QT.html">
            
                <a href="../../0_图形系统/其他/QT.html">
            
                    
                    QT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4.2" data-path="../../0_图形系统/其他/多屏显示分析.html">
            
                <a href="../../0_图形系统/其他/多屏显示分析.html">
            
                    
                    多屏显示分析
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../../0_输入系统/">
            
                <a href="../../0_输入系统/">
            
                    
                    0_输入系统
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../../0_输入系统/Input.html">
            
                <a href="../../0_输入系统/Input.html">
            
                    
                    Input
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../../0_输入系统/全局手势.html">
            
                <a href="../../0_输入系统/全局手势.html">
            
                    
                    全局手势
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../../0_进程管理/">
            
                <a href="../../0_进程管理/">
            
                    
                    0_进程管理
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../../0_进程管理/0_AMS.html">
            
                <a href="../../0_进程管理/0_AMS.html">
            
                    
                    0 AMS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../../0_进程管理/App保活的方式.html">
            
                <a href="../../0_进程管理/App保活的方式.html">
            
                    
                    App保活的方式
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../../0_进程管理/后台杀进程.html">
            
                <a href="../../0_进程管理/后台杀进程.html">
            
                    
                    后台杀进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../../0_进程管理/杀进程原理.html">
            
                <a href="../../0_进程管理/杀进程原理.html">
            
                    
                    杀进程原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../../0_进程管理/进程与子进程.html">
            
                <a href="../../0_进程管理/进程与子进程.html">
            
                    
                    进程与子进程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../../0_进程管理/进程管理系列0_总论.html">
            
                <a href="../../0_进程管理/进程管理系列0_总论.html">
            
                    
                    进程管理系列0_总论
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../../0_进程管理/进程管理系列1之进程的创建.html">
            
                <a href="../../0_进程管理/进程管理系列1之进程的创建.html">
            
                    
                    进程管理系列1之进程的创建
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../../0_进程管理/进程管理系列2之进程的优先级.html">
            
                <a href="../../0_进程管理/进程管理系列2之进程的优先级.html">
            
                    
                    进程管理系列2之进程的优先级
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../../0_进程管理/进程管理系列3之内存回收.html">
            
                <a href="../../0_进程管理/进程管理系列3之内存回收.html">
            
                    
                    进程管理系列3之内存回收
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../">
            
                <a href="../">
            
                    
                    Andriod
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="./">
            
                <a href="./">
            
                    
                    关键流程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1.1" data-path="InitSystem.html">
            
                <a href="InitSystem.html">
            
                    
                    Init System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="startAPP.html">
            
                <a href="startAPP.html">
            
                    
                    Start APP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../其他核心服务/">
            
                <a href="../其他核心服务/">
            
                    
                    其他核心服务
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../其他核心服务/1_InputMethod.html">
            
                <a href="../其他核心服务/1_InputMethod.html">
            
                    
                    1 Input Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../其他核心服务/multi-client-ime.html">
            
                <a href="../其他核心服务/multi-client-ime.html">
            
                    
                    Multi Client Ime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../其他核心服务/无障碍_.html">
            
                <a href="../其他核心服务/无障碍_.html">
            
                    
                    无障碍_
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../0_AndriodSystem.html">
            
                <a href="../0_AndriodSystem.html">
            
                    
                    0 Andriod System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../log框架.html">
            
                <a href="../log框架.html">
            
                    
                    log框架
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../permissions.html">
            
                <a href="../permissions.html">
            
                    
                    Permissions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../模型.html">
            
                <a href="../模型.html">
            
                    
                    模型
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../../coding/">
            
                <a href="../../coding/">
            
                    
                    Coding
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../../coding/0_computorBase/">
            
                <a href="../../coding/0_computorBase/">
            
                    
                    0 Computor Base
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../../coding/0_computorBase/DesignPattern.html">
            
                <a href="../../coding/0_computorBase/DesignPattern.html">
            
                    
                    Design Pattern
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../../coding/0_computorBase/HowToReadCode.html">
            
                <a href="../../coding/0_computorBase/HowToReadCode.html">
            
                    
                    How To Read Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../../coding/0_computorBase/HowWritecode.html">
            
                <a href="../../coding/0_computorBase/HowWritecode.html">
            
                    
                    How Writecode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.4" data-path="../../coding/0_computorBase/linux.html">
            
                <a href="../../coding/0_computorBase/linux.html">
            
                    
                    Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.5" data-path="../../coding/0_computorBase/linux文件系统.html">
            
                <a href="../../coding/0_computorBase/linux文件系统.html">
            
                    
                    linux文件系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.6" data-path="../../coding/0_computorBase/OperateSystem.html">
            
                <a href="../../coding/0_computorBase/OperateSystem.html">
            
                    
                    Operate System
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.7" data-path="../../coding/0_computorBase/refactor.html">
            
                <a href="../../coding/0_computorBase/refactor.html">
            
                    
                    Refactor
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.8" data-path="../../coding/0_computorBase/用户_用户组.html">
            
                <a href="../../coding/0_computorBase/用户_用户组.html">
            
                    
                    用户_用户组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.9" data-path="../../coding/0_computorBase/解耦.html">
            
                <a href="../../coding/0_computorBase/解耦.html">
            
                    
                    解耦
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../../coding/0_IPC/">
            
                <a href="../../coding/0_IPC/">
            
                    
                    0 IPC
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.2.1" data-path="../../coding/0_IPC/AndriodIPC.html">
            
                <a href="../../coding/0_IPC/AndriodIPC.html">
            
                    
                    Andriod IPC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.2" data-path="../../coding/0_IPC/IPC前提_序列化.html">
            
                <a href="../../coding/0_IPC/IPC前提_序列化.html">
            
                    
                    IPC前提_序列化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.3" data-path="../../coding/0_IPC/socket.html">
            
                <a href="../../coding/0_IPC/socket.html">
            
                    
                    Socket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2.4" data-path="../../coding/0_IPC/线程间通信.html">
            
                <a href="../../coding/0_IPC/线程间通信.html">
            
                    
                    线程间通信
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../../coding/0_性能/">
            
                <a href="../../coding/0_性能/">
            
                    
                    0_性能
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.3.1" data-path="../../coding/0_性能/profiler.html">
            
                <a href="../../coding/0_性能/profiler.html">
            
                    
                    Profiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.2" data-path="../../coding/0_性能/Systrace.html">
            
                <a href="../../coding/0_性能/Systrace.html">
            
                    
                    Systrace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.3" data-path="../../coding/0_性能/内存.html">
            
                <a href="../../coding/0_性能/内存.html">
            
                    
                    内存
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3.4" data-path="../../coding/0_性能/性能_.html">
            
                <a href="../../coding/0_性能/性能_.html">
            
                    
                    性能_
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../../coding/1_稳定性/">
            
                <a href="../../coding/1_稳定性/">
            
                    
                    1_稳定性
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.4.1" data-path="../../coding/1_稳定性/ANR.html">
            
                <a href="../../coding/1_稳定性/ANR.html">
            
                    
                    ANR
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4.2" data-path="../../coding/1_稳定性/WatchDog.html">
            
                <a href="../../coding/1_稳定性/WatchDog.html">
            
                    
                    Watch Dog
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../../coding/AndriodCar/">
            
                <a href="../../coding/AndriodCar/">
            
                    
                    Andriod Car
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.5.1" data-path="../../coding/AndriodCar/CarService.html">
            
                <a href="../../coding/AndriodCar/CarService.html">
            
                    
                    Car Service
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../../coding/AndroidTool/">
            
                <a href="../../coding/AndroidTool/">
            
                    
                    Android Tool
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.6.1" data-path="../../coding/AndroidTool/HierarchyView.html">
            
                <a href="../../coding/AndroidTool/HierarchyView.html">
            
                    
                    Hierarchy View
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../../coding/App/">
            
                <a href="../../coding/App/">
            
                    
                    App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.7.1" data-path="../../coding/App/APK_64bit_32bit.html">
            
                <a href="../../coding/App/APK_64bit_32bit.html">
            
                    
                    APK 64 Bit 32 Bit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.2" data-path="../../coding/App/APP开发.html">
            
                <a href="../../coding/App/APP开发.html">
            
                    
                    APP开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.3" data-path="../../coding/App/launcher3.html">
            
                <a href="../../coding/App/launcher3.html">
            
                    
                    Launcher 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.4" data-path="../../coding/App/SystemUI.html">
            
                <a href="../../coding/App/SystemUI.html">
            
                    
                    System UI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7.5" data-path="../../coding/App/小程序.html">
            
                <a href="../../coding/App/小程序.html">
            
                    
                    小程序
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../../coding/CodingLanguage/">
            
                <a href="../../coding/CodingLanguage/">
            
                    
                    Coding Language
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.8.1" data-path="../../coding/CodingLanguage/c_cpp_java.html">
            
                <a href="../../coding/CodingLanguage/c_cpp_java.html">
            
                    
                    C Cpp Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.2" data-path="../../coding/CodingLanguage/java反射.html">
            
                <a href="../../coding/CodingLanguage/java反射.html">
            
                    
                    java反射
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.3" data-path="../../coding/CodingLanguage/JNI.html">
            
                <a href="../../coding/CodingLanguage/JNI.html">
            
                    
                    JNI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.4" data-path="../../coding/CodingLanguage/js.html">
            
                <a href="../../coding/CodingLanguage/js.html">
            
                    
                    Js
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.5" data-path="../../coding/CodingLanguage/python.html">
            
                <a href="../../coding/CodingLanguage/python.html">
            
                    
                    Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8.6" data-path="../../coding/CodingLanguage/R.html">
            
                <a href="../../coding/CodingLanguage/R.html">
            
                    
                    R
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../../coding/Features/">
            
                <a href="../../coding/Features/">
            
                    
                    Features
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.9.1" data-path="../../coding/Features/其他特性.html">
            
                <a href="../../coding/Features/其他特性.html">
            
                    
                    其他特性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9.2" data-path="../../coding/Features/多用户.html">
            
                <a href="../../coding/Features/多用户.html">
            
                    
                    多用户
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.10" >
            
                <span>
            
                    
                    Kde
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.10.1" data-path="../../coding/kde/kwin.html">
            
                <a href="../../coding/kde/kwin.html">
            
                    
                    Kwin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../../coding/other%20OS/README.md">
            
                <span>
            
                    
                    Other OS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.11.1" data-path="../../coding/other%20OS/OpenHarmony.md">
            
                <span>
            
                    
                    Open Harmony
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11.2" data-path="../../coding/other%20OS/otherOS.md">
            
                <span>
            
                    
                    Other OS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../../coding/多线程/">
            
                <a href="../../coding/多线程/">
            
                    
                    多线程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.12.1" data-path="../../coding/多线程/多线程的模型.html">
            
                <a href="../../coding/多线程/多线程的模型.html">
            
                    
                    多线程的模型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12.2" data-path="../../coding/多线程/线程池与binder线程池.html">
            
                <a href="../../coding/多线程/线程池与binder线程池.html">
            
                    
                    线程池与binder线程池
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../../coding/文件系统结构/文件系统结构.html">
            
                <a href="../../coding/文件系统结构/文件系统结构.html">
            
                    
                    文件系统结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../../coding/虚拟化/虚拟化.html">
            
                <a href="../../coding/虚拟化/虚拟化.html">
            
                    
                    虚拟化
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../../Naturalaw/">
            
                <a href="../../Naturalaw/">
            
                    
                    Naturalaw
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../../Naturalaw/ReadingAndThinking.html">
            
                <a href="../../Naturalaw/ReadingAndThinking.html">
            
                    
                    Reading And Thinking
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../../book2.html">
            
                <a href="../../book2.html">
            
                    
                    Book 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../../CheckList.html">
            
                <a href="../../CheckList.html">
            
                    
                    Check List
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Init System</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x76EE;&#x5F55;"><b>1. </b>&#x76EE;&#x5F55;</a></li><li><span class="title-icon "></span><a href="#&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;"><b>2. </b>&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;</a></li><ul><li><span class="title-icon "></span><a href="#0&#x5C42;&#x56FE;"><b>2.1. </b>0&#x5C42;&#x56FE;</a></li><li><span class="title-icon "></span><a href="#&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;"><b>2.2. </b>&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;</a></li><ul><li><span class="title-icon "></span><a href="#loader&#x5C42;&#xFF1A;"><b>2.2.1. </b>Loader&#x5C42;&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#linux&#x5185;&#x6838;&#x5C42;"><b>2.2.2. </b>Linux&#x5185;&#x6838;&#x5C42;</a></li><li><span class="title-icon "></span><a href="#&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42;-hal"><b>2.2.3. </b>&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42; (HAL)</a></li><li><span class="title-icon "></span><a href="#android-runtime--&#x7CFB;&#x7EDF;&#x5E93;"><b>2.2.4. </b>Android Runtime &amp; &#x7CFB;&#x7EDF;&#x5E93;</a></li><li><span class="title-icon "></span><a href="#framework&#x5C42;"><b>2.2.5. </b>Framework&#x5C42;</a></li><li><span class="title-icon "></span><a href="#app&#x5C42;"><b>2.2.6. </b>App&#x5C42;</a></li><li><span class="title-icon "></span><a href="#&#x5899;-syscall"><b>2.2.7. </b>&#x5899; Syscall</a></li><li><span class="title-icon "></span><a href="#&#x5899;jni"><b>2.2.8. </b>&#x5899;JNI</a></li><li><span class="title-icon "></span><a href="#&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;"><b>2.2.9. </b>&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;</a></li></ul><li><span class="title-icon "></span><a href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;"><b>2.3. </b>&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;</a></li><li><span class="title-icon "></span><a href="#------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------"><b>2.4. </b>-------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------</a></li><li><span class="title-icon "></span><a href="#&#x5185;&#x6838;&#x52A0;&#x8F7D;"><b>2.5. </b>&#x5185;&#x6838;&#x52A0;&#x8F7D;</a></li><li><span class="title-icon "></span><a href="#0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;"><b>2.6. </b>0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x5B89;&#x5353;init&#x8FDB;&#x7A0B;-&#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;"><b>2.7. </b>&#x5B89;&#x5353;init&#x8FDB;&#x7A0B; &#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;</a></li><li><span class="title-icon "></span><a href="#init&#x8FDB;&#x7A0B;&#x4E4B;-------&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;"><b>2.8. </b>init&#x8FDB;&#x7A0B;&#x4E4B; ------&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;</a></li><ul><li><span class="title-icon "></span><a href="#init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;"><b>2.8.1. </b>init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;"><b>2.8.2. </b>&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;</a></li></ul><li><span class="title-icon "></span><a href="#servicemanager&#x542F;&#x52A8;&#x6D41;&#x7A0B;"><b>2.9. </b>serviceManager&#x542F;&#x52A8;&#x6D41;&#x7A0B;</a></li><li><span class="title-icon "></span><a href="#zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native-main"><b>2.10. </b>zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native main</a></li><ul><li><span class="title-icon "></span><a href="#runtime&#x7684;&#x542F;&#x52A8;runtimestart"><b>2.10.1. </b>runtime&#x7684;&#x542F;&#x52A8;runtime.start</a></li><li><span class="title-icon "></span><a href="#&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startvmmjavavm-env"><b>2.10.2. </b>&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startVm(&amp;mJavaVM, &amp;env)</a></li><li><span class="title-icon "></span><a href="#startregenv-&#x6CE8;&#x518C;jni&#x51FD;&#x6570;"><b>2.10.3. </b>startReg(env) &#x6CE8;&#x518C;JNI&#x51FD;&#x6570;</a></li></ul><li><span class="title-icon "></span><a href="#zygoteinitjava--main-&#x4E16;&#x754C;"><b>2.11. </b>ZygoteInit.java  main &#x4E16;&#x754C;</a></li><ul><li><span class="title-icon "></span><a href="#&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload"><b>2.11.1. </b>&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload()</a></li><li><span class="title-icon "></span><a href="#forksystemserver"><b>2.11.2. </b>forkSystemServer</a></li><li><span class="title-icon "></span><a href="#zygoteinitrunselectloop"><b>2.11.3. </b>ZygoteInit.runSelectLoop</a></li></ul><li><span class="title-icon "></span><a href="#systemserver&#x8FDB;&#x7A0B;&#x542F;&#x52A8;"><b>2.12. </b>SystemServer&#x8FDB;&#x7A0B;&#x542F;&#x52A8;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;msystemservicemanagerstartservice"><b>2.12.1. </b>&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;mSystemServiceManager.startService</a></li><li><span class="title-icon "></span><a href="#publishbinderservice-&#x5411;native&#x6CE8;&#x518C;ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;"><b>2.12.2. </b>publishBinderService &#x5411;Native&#x6CE8;&#x518C;Ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;</a></li><li><span class="title-icon "></span><a href="#ams-new&#x540E;&#xFF0C;&#x7531;ams&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;"><b>2.12.3. </b>AMS new&#x540E;&#xFF0C;&#x7531;AMS&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;</a></li></ul><li><span class="title-icon "></span><a href="#------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------"><b>2.13. </b>-------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------</a></li><li><span class="title-icon "></span><a href="#&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;"><b>2.14. </b>&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;"><b>2.15. </b>&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</a></li><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;"><b>2.16. </b>&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</a></li><li><span class="title-icon "></span><a href="#&#x7591;&#x95EE;"><b>2.17. </b>&#x7591;&#x95EE;</a></li><li><span class="title-icon "></span><a href="#&#x9762;&#x8BD5;&#x9898;"><b>2.18. </b>&#x9762;&#x8BD5;&#x9898;:</a></li><ul><li><span class="title-icon "></span><a href="#&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;systemserver&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;zygote&#xFF1F;"><b>2.18.1. </b>&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;SystemServer&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;Zygote&#xFF1F;</a></li><li><span class="title-icon "></span><a href="#&#x65E2;&#x7136;zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709;-zygote&#xFF1F;"><b>2.18.2. </b>&#x65E2;&#x7136;Zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709; Zygote&#xFF1F;</a></li><li><span class="title-icon "></span><a href="#zygote&#x7684;ipc&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;"><b>2.18.3. </b>Zygote&#x7684;IPC&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;</a></li></ul><li><span class="title-icon "></span><a href="#&#x53C2;&#x8003;"><b>2.19. </b>&#x53C2;&#x8003;</a></li></ul><li><span class="title-icon "></span><a href="#linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;"><b>3. </b>linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;</a></li><ul><li><span class="title-icon "></span><a href="#todo&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;"><b>3.1. </b>TODO&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;</a></li></ul></ul></div><a href="#&#x76EE;&#x5F55;" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><div class="treeview__container"><ul>
<li><div><a href="#&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;">&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#0&#x5C42;&#x56FE;">0&#x5C42;&#x56FE;</a><i></i></div></li>
<li><div><a href="#&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;">&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#loader&#x5C42;&#xFF1A;">Loader&#x5C42;&#xFF1A;</a><i></i></div></li>
<li><div><a href="#linux&#x5185;&#x6838;&#x5C42;">Linux&#x5185;&#x6838;&#x5C42;</a><i></i></div></li>
<li><div><a href="#&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42;-hal">&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42; (HAL)</a><i></i></div></li>
<li><div><a href="#android-runtime-amp-&#x7CFB;&#x7EDF;&#x5E93;">Android Runtime &amp; &#x7CFB;&#x7EDF;&#x5E93;</a><i></i></div></li>
<li><div><a href="#framework&#x5C42;">Framework&#x5C42;</a><i></i></div></li>
<li><div><a href="#app&#x5C42;">App&#x5C42;</a><i></i></div></li>
<li><div><a href="#&#x5899;-syscall">&#x5899; Syscall</a><i></i></div></li>
<li><div><a href="#&#x5899;jni">&#x5899;JNI</a><i></i></div></li>
<li><div><a href="#&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;">&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;">&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;</a><i></i></div></li>
<li><div><a href="#------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------">-------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------</a><i></i></div></li>
<li><div><a href="#&#x5185;&#x6838;&#x52A0;&#x8F7D;">&#x5185;&#x6838;&#x52A0;&#x8F7D;</a><i></i></div></li>
<li><div><a href="#0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;">0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#&#x5B89;&#x5353;init&#x8FDB;&#x7A0B;-&#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;">&#x5B89;&#x5353;init&#x8FDB;&#x7A0B; &#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;</a><i></i></div></li>
<li><div><a href="#init&#x8FDB;&#x7A0B;&#x4E4B;-------&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;">init&#x8FDB;&#x7A0B;&#x4E4B; ------&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;">init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;">&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;</a><i></i></div></li>
</ul></li>
<li><div><a href="#servicemanager&#x542F;&#x52A8;&#x6D41;&#x7A0B;">serviceManager&#x542F;&#x52A8;&#x6D41;&#x7A0B;</a><i></i></div></li>
<li><div><a href="#zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native-main">zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native main</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#runtime&#x7684;&#x542F;&#x52A8;runtimestart">runtime&#x7684;&#x542F;&#x52A8;runtime.start</a><i></i></div></li>
<li><div><a href="#&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startvmampmjavavm-ampenv">&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startVm(&amp;mJavaVM, &amp;env)</a><i></i></div></li>
<li><div><a href="#startregenv-&#x6CE8;&#x518C;jni&#x51FD;&#x6570;">startReg(env) &#x6CE8;&#x518C;JNI&#x51FD;&#x6570;</a><i></i></div></li>
</ul></li>
<li><div><a href="#zygoteinitjava--main-&#x4E16;&#x754C;">ZygoteInit.java  main &#x4E16;&#x754C;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload">&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload()</a><i></i></div></li>
<li><div><a href="#forksystemserver">forkSystemServer</a><i></i></div></li>
<li><div><a href="#zygoteinitrunselectloop">ZygoteInit.runSelectLoop</a><i></i></div></li>
</ul></li>
<li><div><a href="#systemserver&#x8FDB;&#x7A0B;&#x542F;&#x52A8;">SystemServer&#x8FDB;&#x7A0B;&#x542F;&#x52A8;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;msystemservicemanagerstartservice">&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;mSystemServiceManager.startService</a><i></i></div></li>
<li><div><a href="#publishbinderservice-&#x5411;native&#x6CE8;&#x518C;ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;">publishBinderService &#x5411;Native&#x6CE8;&#x518C;Ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;</a><i></i></div></li>
<li><div><a href="#ams-new&#x540E;&#xFF0C;&#x7531;ams&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;">AMS new&#x540E;&#xFF0C;&#x7531;AMS&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;</a><i></i></div></li>
</ul></li>
<li><div><a href="#------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------">-------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------</a><i></i></div></li>
<li><div><a href="#&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;">&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;</a><i></i></div></li>
<li><div><a href="#&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;">&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</a><i></i></div></li>
<li><div><a href="#&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;">&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</a><i></i></div></li>
<li><div><a href="#&#x7591;&#x95EE;">&#x7591;&#x95EE;</a><i></i></div></li>
<li><div><a href="#&#x9762;&#x8BD5;&#x9898;">&#x9762;&#x8BD5;&#x9898;:</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;systemserver&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;zygote&#xFF1F;">&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;SystemServer&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;Zygote&#xFF1F;</a><i></i></div></li>
<li><div><a href="#&#x65E2;&#x7136;zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709;-zygote&#xFF1F;">&#x65E2;&#x7136;Zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709; Zygote&#xFF1F;</a><i></i></div></li>
<li><div><a href="#zygote&#x7684;ipc&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;">Zygote&#x7684;IPC&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;</a><i></i></div></li>
</ul></li>
<li><div><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a><i></i></div></li>
</ul></li>
<li><div><a href="#linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;">linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;</a><i class="level__parent level__item level__parent--opened" state="opened" onclick="var curState = this.getAttribute(&apos;state&apos;);var nextState = curState === &apos;opened&apos; ? &apos;hidden&apos; : &apos;opened&apos;;this.setAttribute(&apos;state&apos;, nextState);this.className = this.className.split(curState).join(nextState);var list = this.parentNode.nextElementSibling;if (nextState === &apos;hidden&apos;) {    list.style.display = &apos;none&apos;;} else {    list.style.display = &apos;block&apos;;}"></i></div>
<ul>
<li><div><a href="#todo&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;">TODO&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;</a><i></i></div></li>
</ul></li>
</ul>
</div>

<h1 id="&#x76EE;&#x5F55;"><a name="&#x76EE;&#x5F55;" class="anchor-navigation-ex-anchor" href="#&#x76EE;&#x5F55;"><i class="fa fa-link" aria-hidden="true"></i></a>1. &#x76EE;&#x5F55;</h1>
<h1 id="&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;"><a name="&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;" class="anchor-navigation-ex-anchor" href="#&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#xFF08;&#x7EB5;&#x5411;&#x4E3B;&#x7EBF;&#xFF09;</h1>
<p>&#x4E3B;&#x7EBF;&#xFF1A;&#x5F00;&#x673A; ----&gt;  &#x684C;&#x9762;&#xFF08;launcher + systemUI&#xFF09;</p>
<h2 id="0&#x5C42;&#x56FE;"><a name="0&#x5C42;&#x56FE;" class="anchor-navigation-ex-anchor" href="#0&#x5C42;&#x56FE;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. 0&#x5C42;&#x56FE;</h2>
<p><img src="InitSystem.assets/image-20230312001326416.png" alt="image-20230312001326416"></p>
<p>&#x56FE;&#xFF1A;startApp.eddx</p>
<p><strong>&#x603B;&#x7ED3;&#xFF1A;</strong></p>
<ol>
<li><p>&#x5316;&#x7B80;&#xFF1A;<strong>init&#x8FDB;&#x7A0B;&#x4E0E;zygote&#x662F;&#x4E00;&#x6837;&#x7684;</strong>&#xFF0C;<del>&#x4E00;&#x4E2A;&#x62C9;&#x8D77;cpp&#x7684;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#xFF0C;&#x4E00;&#x4E2A;&#x5B75;&#x5316;Java&#x7684;&#x8FDB;&#x7A0B;</del>  ---&gt;  <del>zygote&#x53EF;&#x5220;</del></p>
</li>
<li><p>&#x5316;&#x7B80;&#x4E4B;&#x5408;&#x7406;&#x6027;&#xFF1A;&#x6574;&#x5F20;&#x56FE;&#xFF0C;&#x76EE;&#x6807;&#x5C31;&#x662F;&#x542F;&#x52A8;native&#x548C;java&#x7684;&#x670D;&#x52A1;</p>
<p>&#x200B;                         &#x81EA;&#x7136;&#xFF1A;<del>&#x5148;&#x542F;&#x52A8;native&#x670D;&#x52A1;&#xFF0C;&#x4E4B;&#x540E;java</del></p>
<p>&#x200B;                         &#x81EA;&#x7136;&#xFF1A; <del>&#x542F;&#x52A8;native&#x4F17;&#x591A;&#x670D;&#x52A1;&#x4E4B;&#x524D;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x5148;&#x542F;&#x52A8;serverManager&#x6765;&#x7BA1;&#x7406;  ---&gt;  ~~serverManager&#x53EF;&#x5220;</del></p>
<p>&#x200B;                          &#x81EA;&#x7136;&#xFF1A;<del>&#x542F;&#x52A8;java &#x670D;&#x52A1;&#x4E4B;&#x524D;&#xFF0C;java-native&#x7684;&#x81EA;&#x7136;&#x6709;&#x8BED;&#x8A00;&#x5899;&#x3001;&#x642D;&#x5EFA;&#x597D;&#x68AF;&#x5B50;jni ----&gt;  ~~Runtime &#x81EA;&#x7136;&#xFF0C;&#x53EF;&#x5220;</del>         </p>
</li>
</ol>
<p>&#x200B;                                 &#x81EA;&#x7136;&#xFF1A;<del>zygote&#x5B58;&#x5728;&#x5408;&#x7406;&#x6027;&#xFF1A;&#x53EA;&#x662F;&#x4E3A;&#x4E86; fork  java&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#x800C;&#x5B58;&#x5728;&#x7684; ---&gt; ~~zygote&#x53EF;&#x4EE5;&#x5220;&#x6389;</del></p>
<p><strong>&#x603B;&#x4E4B;&#xFF1A;</strong></p>
<p>1&#x3001;&#x542F;&#x52A8;&#x81EA;&#x4E0B;&#x800C;&#x4E0A;&#xFF1B;&#x8C03;&#x7528;&#xFF0C;&#x81EA;&#x4E0A;&#x800C;&#x4E0B;&#xFF08;<del>&#x6700;&#x7EC8;&#x5185;&#x6838;&#x9A71;&#x52A8;</del>&#xFF0C;&#x81EA;&#x7136;&#xFF09;</p>
<p>2<strong>&#x3001;&#x53EA;&#x9700;&#x8981;&#x8BB0;&#xFF1A;&#x6574;&#x5F20;&#x56FE;&#xFF0C;&#x76EE;&#x6807;&#x5C31;&#x662F;&#x542F;&#x52A8;native&#x548C;java&#x7684;&#x670D;&#x52A1;</strong>&#x3002;<strong>&#x5176;&#x4ED6;&#x7684;&#x90FD;&#x53EF;&#x4EE5;&#x5220;&#x4E86;</strong>&#xFF08;&#x662F;&#x5408;&#x7406;&#x6027;&#x4E0B;&#x7684;&#x5FC5;&#x7136;&#xFF09;&#x3002;</p>
<p> <strong>&#x76D8;&#x53E4;&#x5F00;&#x5929;&#x8F9F;&#x5730;&#x3001;&#x5973;&#x5A32;&#x9020;&#x4EBA;&#x3001;&#x5973;&#x4EBA;&#x751F;&#x5B69;&#x5B50;&#x6A21;&#x578B;&#xFF1A;</strong></p>
<p><strong>&#x4EBA;&#xFF08;&#x7C7B;&#x56FE;&#xFF09;&#xFF0C;&#x4E8B;&#xFF08;&#x6D41;&#x7A0B;&#x56FE;&#xFF09;&#xFF1A;</strong></p>
<p> &#x76D8;&#x53E4;&#xFF0C;pid=0 &#x5185;&#x6838;&#x8FDB;&#x7A0B;&#xFF1A;</p>
<blockquote>
<p>&#x81EA;&#x7136;&#x7684;&#xFF1A;  <del>&#x5929;&#x5730;&#x672A;&#x5F00;&#xFF0C;&#x5B87;&#x5B99;&#x6DF7;&#x6C8C;&#x5982;&#x9E21;&#x86CB;&#xFF08;<strong>&#x5373;kernel</strong>&#xFF09;&#x4E00;&#x7247;</del>----&#x300B; &#x5373;&#x5F53;&#x65F6;&#x53EA;&#x6709;kernel&#xFF0C;&#x81EA;&#x7136;</p>
<font color="red">&#x76EE;&#x6807;&#xFF1A;&#x5F00;&#x5929;&#x8F9F;&#x5730;</font>

<p>&#x6D41;&#x7A0B;&#xFF1A;</p>
<p>&#x200B;                 &#xFF08;0&#xFF09;&#x89E6;&#x53D1;&#x70B9;&#xFF1A;TODO
&#x200B;                &#xFF08;1&#xFF09;  <del>&#x76D8;&#x53E4; &#x5904;&#x4E8E;&#x6DF7;&#x6C8C;&#x4E2D;&#xFF0C;&#x5373; pid=0 &#x5185;&#x6838;&#x8FDB;&#x7A0B;&#x5728;&#x5185;&#x6838;&#x4E2D;&#xFF0C;</del>&#x81EA;&#x7136; 
&#x200B;                &#xFF08;2&#xFF09;  &#x76D8;&#x53E4;&#x5F00;&#x5929;&#x8F9F;&#x5730;&#xFF1A;   &#x8F9F;&#x5730;-------- <del>pid=0 &#x5185;&#x6838;&#x8FDB;&#x7A0B;&#xFF0C; &#x52A0;&#x8F7D;&#x9A71;&#x52A8;&#xFF0C;&#x8FD9;&#x662F;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x7684;&#x57FA;&#x7840;&#xFF08;<strong>&#x5373;&#x5730;</strong>&#xFF09;&#xFF0C;</del>&#x81EA;&#x7136;</p>
<p>&#x200B;                                                          &#x5F00;&#x5929;-------<del>pid=0 &#x5185;&#x6838;&#x8FDB;&#x7A0B;&#xFF0C;&#x5B75;&#x5316;&#x4E86;&#x7B2C;&#x4E00;&#x4E2A; &#x7528;&#x6237;&#x7A7A;&#x95F4; &#x8FDB;&#x7A0B;init(pid=1) &#x5973;&#x5A32;</del> &#xFF0C;&#x81EA;&#x7136;</p>
</blockquote>
<p>&#x5B87;&#x5B99;&#x6DF7;&#x6C8C;&#xFF1A;kernel       </p>
<blockquote>
<p>&#x81EA;&#x7136;&#xFF0C;<del>&#x91CC;&#x9762;&#x6709;&#x76D8;&#x53E4;</del></p>
<p><img src="InitSystem.assets/a2cc7cd98d1001e981db53937330fde855e7970e.jpeg@f_auto" alt="img"></p>
</blockquote>
<p>&#x5929;&#x4E0E;&#x5730;&#x4E4B;&#x95F4;&#xFF0C;&#x4EBA;&#x95F4;&#xFF1A;&#x7528;&#x6237;&#x7A7A;&#x95F4;</p>
<p>&#x9020;&#x4EBA;&#x7684; &#x5973;&#x5A32;&#xFF1A; </p>
<blockquote>
<p>&#x81EA;&#x7136;&#xFF1A;init&#x8FDB;&#x7A0B; pid=1&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;<del>&#x4E3A;&#x5565;&#x53EB;init&#x8FDB;&#x7A0B;&#xFF1F; &#x7B2C;&#x4E00;&#x4E2A;&#x6765;&#x5230;&#x5929;&#x5730;&#x95F4;&#x7684;&#xFF0C;&#x6765;  &#x521B;&#x9020;&#x4EBA;&#x7684;&#xFF08;init&#x7684;&#xFF09;</del>&#xFF0C;&#x81EA;&#x7136;</p>
<font color="red">&#x76EE;&#x6807;&#xFF1A;&#x9020;&#x4EBA;</font>

<p>&#x6D41;&#x7A0B;&#xFF1A;</p>
<p>&#x200B;                    &#xFF08;0&#xFF09;&#x89E6;&#x53D1;&#x70B9;&#xFF1A;<del>&#x5973;&#x5A32;&#x662F;&#x88AB;&#x76D8;&#x53E4;&#x53EB;&#x6765; &#x521B;&#x4E16;&#x7684;</del>&#xFF0C;&#x81EA;&#x7136;&#x3002; &#x5973;&#x5A32;&#x5446;&#x5728; &#x9662;&#x5B50;&#x91CC;&#xFF08;native&#xFF09;  &#x521B;&#x9020;&#x4EBA;</p>
<p>&#x200B;                    &#xFF08;1&#xFF09;&#x6839;&#x636E;&#x5929;&#x4E66;&#xFF0C;<font color="red">&#x56E0;&#x4E3A;&#x5973;&#x5A32;&#x76EE;&#x6807;&#x662F;&#x9020;&#x4EBA;&#xFF0C;&#x90A3;&#x4E48;&#x5148;&#x6709;&#x7BA1;&#x7406;&#x8005;</font>&#x3002;&#x9996;&#x5148; &#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x5929;&#x5730;&#x7684; &#x7389;&#x7687;&#x5927;&#x5E1D;&#xFF1A; init&#x8FDB;&#x7A0B; &#x89E3;&#x6790; init.rc&#xFF0C;&#x9996;&#x5148;&#x521B;&#x5EFA;&#x4E86;1  ServiceManager</p>
<p>&#x200B;                    &#xFF08;2&#xFF09;&#x6839;&#x636E;&#x5929;&#x4E66;&#xFF0C;<font color="red">&#x56E0;&#x4E3A;&#x76EE;&#x6807;&#x662F;&#x9020;&#x4EBA;&#xFF0C;</font>&#x6240;&#x4EE5;&#x5148;&#x521B;&#x5EFA;&#x4E86;&#x4EBA;&#x7684;&#x773C;&#x775B;&#xFF08;&#x663E;&#x793A;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;surfaceFlinger&#xFF09;&#x3001;&#x521B;&#x5EFA;&#x4EBA;&#x7684;&#x8033;&#x6735;&#xFF08;Media Server&#xFF09;</p>
<p>&#x200B;                    &#xFF08;3&#xFF09;&#x6839;&#x636E;&#x5929;&#x4E66;&#xFF0C;<font color="red">&#x56E0;&#x4E3A;&#x76EE;&#x6807;&#x662F;&#x9020;&#x4EBA;</font>&#xFF0C;&#x6700;&#x540E;&#x5728;&#x9662;&#x5B50;&#x91CC;&#xFF08;native&#xFF09;&#x634F;&#x4E86;&#x4E00;&#x4E2A; &#x5973;&#x4EBA;&#xFF08;zygote native&#x8FDB;&#x7A0B;&#xFF09;</p>
</blockquote>
<p>init.rc:  &#x5929;&#x4E66;&#xFF1A;&#x5982;&#x4F55;&#x521B;&#x4E16;&#x7684;&#x5929;&#x4E66;</p>
<p>&#x7389;&#x7687;&#x5927;&#x5E1D;&#xFF1A; ServiceManager&#xFF0C;</p>
<blockquote>
<p>&#x81EA;&#x7136;&#x7684;&#xFF1A; <del>&#x7BA1;&#x7406;&#x5929;&#x5730;&#x4E00;&#x5207;(<font color="red">java&#x548C;native&#x4E24;&#x4E2A;&#x4E16;&#x754C;</font>&#x7684;&#x6240;&#x6709;&#x670D;&#x52A1;)&#xFF0C;&#x6BD4;&#x5982;2  &#x4E16;&#x95F4;&#x4E00;&#x5207;&#x89C6;&#x89C9;&#x7684;&#x663E;&#x793A;&#xFF08;&#x663E;&#x793A;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#xFF09;&#xFF0C;&#x6BD4;&#x5982;3 &#x4E00;&#x5207;&#x58F0;&#x97F3;&#xFF08;&#x5A92;&#x4F53;&#x670D;&#x52A1;&#x8FDB;&#x7A0B;&#xFF09;&#xFF0C;&#x773C;&#xFF08;&#x663E;&#x793A;&#xFF09;&#x3001;&#x8033;&#xFF08;&#x58F0;&#x97F3;&#xFF09;&#x3001;</del>&#x9F3B;<del>&#x3001;</del>&#x820C;<del>&#x3001;&#x8EAB;&#xFF08;&#x89E6;&#x89C9;&#xFF1A;inputManagerService&#xFF09;&#x3001;</del>&#x610F;<del>&#xFF1B;</del>    &#x81EA;&#x7136;</p>
</blockquote>
<p><img src="InitSystem.assets/image-20230214213141534.png" alt="image-20230214213141534"></p>
<p>&#x5973;&#x4EBA;&#xFF1A;zygote native&#x8FDB;&#x7A0B;</p>
<blockquote>
<p> &#x5929;&#x7136;&#x7684;&#xFF1A; &#x5973;&#x4EBA;&#xFF0C;&#x5929;&#x751F;&#x5C31;&#x662F; &#x751F;&#x5B69;&#x5B50;&#x7684;&#xFF08;&#x5B75;&#x5316;java&#x8FDB;&#x7A0B;&#x7684;&#xFF09;&#xFF0C;&#x81EA;&#x7136;</p>
<p><font color="red">&#x76EE;&#x6807;&#xFF1A;</font>  &#x751F;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x5BB6;&#x5EAD;</p>
<p>&#x6D41;&#x7A0B;&#xFF1A;</p>
<p>&#x200B;              &#xFF08;1&#xFF09; &#x89E6;&#x53D1;&#x70B9;&#xFF1A;&#x5973;&#x5A32;&#x5728;&#x9662;&#x5B50;&#x91CC;&#x9020;&#x51FA;&#x4E86;&#x5973;&#x4EBA;</p>
<p>&#x200B;               &#xFF08;2&#xFF09;&#x5973;&#x4EBA;&#x60F3;&#x8981;&#x4ECE;&#x9662;&#x5185;&#x8DD1;&#x5230;&#x9662;&#x5916;&#xFF0C;&#x81EA;&#x7136;&#xFF1A; &#x9662;&#x5185;&#x7684;&#x5973;&#x4EBA; &#x8981;&#x642C;&#x68AF;&#x5B50; &#xFF1A;<del>zygote native&#x8FDB;&#x7A0B;   &#x5B89;&#x5353;&#x7684;Runtime&#xFF08;&#x5305;&#x62EC;jvm&#x3001;&#x6CE8;&#x518C;jni&#xFF09;</del></p>
<p>&#x200B;               &#xFF08;3&#xFF09;&#x5973;&#x4EBA;&#x901A;&#x8FC7;&#x68AF;&#x5B50;  &#x7FFB;&#x5899;&#x3002;&#x81EA;&#x7136;&#xFF1A;zygote native&#x8FDB;&#x7A0B; &#x901A;&#x8FC7; &#x53CD;&#x5C04; &#x8C03;&#x7528;&#x4E86; zygoteInit.java&#x7684;main&#x51FD;&#x6570;</p>
<p>&#x200B;               &#xFF08;4&#xFF09;&#x7FFB;&#x5899;&#x5230;&#x4E86;&#x9662;&#x5916;&#xFF0C;&#x4FBF;&#x662F;&#x9662;&#x5916;&#x7684;&#x5973;&#x4EBA;&#xFF1A; zygote&#x8FD0;&#x884C;&#x5728;java&#x73AF;&#x5883;&#x4E2D;&#x4E86;</p>
<p>&#x200B;                &#xFF08;5&#xFF09;&#x9662;&#x5916;&#x6709;&#x5927;&#x91CF;&#x7684;&#x81EA;&#x7136;&#x8D44;&#x6E90;&#xFF0C;&#x81EA;&#x7136;&#x3002;&#x5973;&#x4EBA;<font color="red"> &#x5148;&#x5F04;&#x4E86;&#x4E00;&#x4E9B;  &#x82B1;&#x8349;&#x6811;&#x53F6; &#x7ED9;&#x81EA;&#x5DF1;&#x7A7F;&#x8863;</font>&#xFF1A;&#x52A0;&#x8F7D;&#x7C7B;&#x3001;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;color&#x3001;&#x5E93;so&#x5230;jvm</p>
<p>&#x200B;                &#xFF08;6&#xFF09;&#x5F04;&#x597D;&#x4E86;&#x81EA;&#x5DF1;&#xFF0C;&#x62FF;&#x51FA;&#x6765;&#x81EA;&#x5DF1;&#x4E00;&#x4E2A;&#x808B;&#x9AA8;&#xFF0C;&#x53D8;&#x6210;&#x4E86;&#x81EA;&#x5DF1;&#x7684;&#x4E08;&#x592B;&#xFF1A;  SystemSever&#x3002;&#x3002;&#x3002;<strong>&#x6CE8;&#x610F;&#xFF1A;&#x53EA;&#x6709;&#x751F; &#x4E08;&#x592B;&#xFF0C;&#x662F;&#x5973;&#x4EBA;&#x81EA;&#x5DF1;&#x4E3B;&#x52A8;&#x89E6;&#x53D1;&#x7684;&#xFF1B;&#x800C;&#x5176;&#x4ED6;&#x5B69;&#x5B50;&#xFF0C;&#x90FD;&#x662F;&#x522B;&#x4EBA;&#x8BA9;&#x7684;</strong></p>
<p>&#x200B;                 &#xFF08;7&#xFF09;&#x6709;&#x4E86;&#x4E08;&#x592B;&#xFF0C;&#x600E;&#x4E48;&#x4E0E;&#x4E08;&#x592B;&#x4E4B;&#x95F4;&#x8054;&#x7CFB;&#x5462;&#xFF1F; &#x5973;&#x4EBA;&#x4E70;&#x4E86;&#x4E2A; &#x5BF9;&#x8BB2;&#x673A; &#xFF1A;&#x8D77;&#x4E86;&#x4E00;&#x4E2A;socket &#x670D;&#x52A1;&#xFF0C;&#x4E00;&#x76F4;&#x5FAA;&#x73AF;&#xFF0C;&#x7B49;&#x5F85;&#x4E08;&#x592B;&#x7684;&#x6D88;&#x606F;
&#x200B;                    &#x6CE8;&#x610F;&#xFF1A;&#x4E0D;&#x5F97;&#x4E0D;&#xFF1A;&#x5973;&#x4EBA;&#x53EA;&#x542C;&#x4E08;&#x592B;&#x7684;&#xFF0C;&#x81EA;&#x7136;&#xFF1A; &#x5973;&#x4EBA;&#x53EA;&#x901A;&#x8FC7;socket&#x4E0E;&#x4E08;&#x592B;&#x4EA4;&#x6D41;
&#x200B;                                 &#x81EA;&#x7136;&#xFF1A; &#x53EA;&#x6709;&#x4E08;&#x592B;&#x80FD;&#x8BA9;&#x5973;&#x4EBA;&#x751F;&#x5B69;&#x5B50;&#x3002;<del>&#x5B69;&#x5B50;&#x5219;&#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x8BA9;&#xFF0C;&#x9700;&#x8981;&#x544A;&#x8BC9;&#x7236;&#x4EB2;&#xFF0C;&#x8BA9;&#x5988;&#x5988;&#x751F;&#x4E2A;&#x5F1F;&#x5F1F;&#xFF0C;&#x7236;&#x4EB2;&#x518D;&#x8BA9;&#x5973;&#x4EBA;&#x751F;&#x3002;</del></p>
<p>&#x200B;                </p>
</blockquote>
<p>&#x4E08;&#x592B;&#xFF1A; SystemSever</p>
<blockquote>
<p>&#x200B;              &#x81EA;&#x7136;&#xFF0C;&#x4ED6;&#x7684;&#x4F5C;&#x7528;&#x662F;&#xFF0C;&#x7ED9;&#x513F;&#x5B50;&#x4EEC;(APP)&#xFF0C;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#xFF1A; SystemSever&#x7ED9;APP &#x63D0;&#x4F9B;&#x6838;&#x5FC3;&#x670D;&#x52A1;    </p>
<p>&#x76EE;&#x6807;&#xFF1A;&#x4E08;&#x592B;&#x6709;&#x4E86;&#xFF0C;&#x53EF;&#x662F;&#x8FD8;&#x6CA1;&#x6709;&#x5B69;&#x5B50;&#xFF0C;<font color="red">&#x751F;&#x4E00;&#x4E2A;&#x5BB6;&#x5EAD;&#x5BF9;&#x5916;&#x7684; &#x63A5;&#x53E3;&#x4EBA;</font></p>
<p>&#x6D41;&#x7A0B;&#xFF1A;</p>
<p>&#xFF08;1&#xFF09;&#x89E6;&#x53D1;&#x70B9;&#xFF1A;&#x5973;&#x4EBA; &#x201C;&#x751F;&#x201D;&#x4E86;&#x4E08;&#x592B;</p>
<p>&#xFF08;2&#xFF09;&#x4E08;&#x592B;&#x544A;&#x8BC9;&#x5973;&#x4EBA;&#xFF0C;&#x8981;&#x751F;&#x4E00;&#x4E2A; &#x5BB6;&#x5EAD;&#x5BF9;&#x5916;&#x7684; &#x63A5;&#x53E3;&#x4EBA;&#xFF0C;&#x770B;&#x5BA2;&#x6237;&#x6709;&#x5565;&#x9700;&#x6C42;&#xFF1A; &#x5373;AMS &#x8BA9;  zygote &#x521B;&#x5EFA; launcher&#x8FDB;&#x7A0B;      </p>
</blockquote>
<p>&#x5BB6;&#x5EAD;&#x5BF9;&#x5916;&#x7684; &#x63A5;&#x53E3;&#x4EBA;  &#xFF1A;launcher&#x8FDB;&#x7A0B;</p>
<p>&#x200B;             &#x6839;&#x636E; &#x5BA2;&#x6237;&#x9700;&#x8981;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x5B69;&#x5B50;&#xFF0C;&#x5C31;&#x8BA9;&#x5973;&#x4EBA;&#x53BB;&#x751F;</p>
<p>&#x9662;&#x5B50;&#x91CC;&#xFF1A;native</p>
<p>&#x9662;&#x5B50;&#x5916;&#xFF1A;java</p>
<p>&#x5899;&#xFF1A;cpp&#x4E0E;java&#x7684;&#x8BED;&#x8A00;&#x9694;&#x79BB;</p>
<p>&#x5899;&#x4E0A;&#x7684;&#x68AF;&#x5B50;&#xFF1A; &#x5B89;&#x5353;&#x7684;Runtime&#x3001;jni&#x3001;jvm</p>
<p>&#x4E00;&#x53E5;&#x8BDD;&#x603B;&#x7ED3;&#xFF0C; &#x76D8;&#x53E4;&#x5F00;&#x5929;&#x8F9F;&#x5730;&#x3001;&#x5973;&#x5A32;&#x9020;&#x4EBA;&#x3001;&#x5973;&#x4EBA;&#x751F;&#x5B69;&#x5B50;&#x6A21;&#x578B;&#xFF1A;</p>
<blockquote>
<font color="red">&#x8BB0;&#x5FC6;&#x4E09;&#x4E2A;&#x76EE;&#x6807;&#xFF0C;&#x5FD8;&#x8BB0;&#x5176;&#x4ED6;&#x6240;&#x6709;&#x3002;</font>





</blockquote>
<p>&#x8865;&#x5145;&#xFF1A;</p>
<blockquote>
<p>2&#x3001;3&#x3001;4&#xFF0C;&#x4E3A;&#x5565;&#x662F;&#x8FD9;&#x4E2A;&#x987A;&#x5E8F;&#xFF1F;&#xFF1A;&#x81EA;&#x7136;&#x5973;&#x5A32;&#x5148; &#x634F;&#x773C;&#x8033;&#x9F3B;&#x820C;&#x8EAB;&#x610F;&#xFF0C;&#x6700;&#x540E;&#x624D;&#x634F;&#x4E86;&#x4E00;&#x4E2A;&#x5B8C;&#x6574;&#x7684;&#x4EBA;&#xFF08;&#x6B64;&#x65F6;Zygote&#x5C31;&#x662F;&#x53EF;&#x4EE5;&#x8C03;&#x7528;surfaceFlinger&#x7B49;&#x7684;&#xFF09;</p>
</blockquote>
<p>TODO:  &#x4E0A;&#x9762;&#x6A21;&#x578B;&#x7684; &#x6587;&#x5B57;&#x63CF;&#x8FF0;&#xFF0C;&#x4E5F;&#x662F;&#x5199;&#x6587;&#x7AE0;&#x7684;&#x601D;&#x8DEF;&#xFF08;<font color="red">&#x5373;&#x6587;&#x5B57;&#x7248;&#x7684; &#x7C7B;&#x56FE;&#x548C;&#x65F6;&#x5E8F;&#x56FE;</font>&#xFF09;&#x3002;&#x5F85;&#x8BE6;&#x7EC6;&#x5B8C;&#x5584;</p>
<p>TODO:
&#x4E0A;&#x9762;&#x662F;&#x901A;&#x8FC7;&#x8054;&#x60F3;&#x6A21;&#x578B;&#x8BB0;&#x5FC6;&#xFF0C;&#x5982;&#x679C;  &#x901A;&#x8FC7; &#x4E0D;&#x5F97;&#x4E0D; &#x6765;&#x8BB0;&#x5FC6;&#x5462;&#xFF1F;</p>
<h2 id="&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;"><a name="&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;" class="anchor-navigation-ex-anchor" href="#&#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x5404;&#x4E2A;&#x5C42;&#x7684;&#x7B80;&#x4ECB;</h2>
<h3 id="loader&#x5C42;&#xFF1A;"><a name="loader&#x5C42;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#loader&#x5C42;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1. Loader&#x5C42;&#xFF1A;</h3>
<ul>
<li>Boot ROM:  &#x5F53;&#x624B;&#x673A;&#x5904;&#x4E8E;&#x5173;&#x673A;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x957F;&#x6309;Power&#x952E;&#x5F00;&#x673A;&#xFF0C;&#x5F15;&#x5BFC;&#x82AF;&#x7247;&#x5F00;&#x59CB;&#x4ECE;&#x56FA;&#x5316;&#x5728;<code>ROM</code>&#x91CC;&#x7684;&#x9884;&#x8BBE;&#x4EE3;&#x7801;&#x5F00;&#x59CB;&#x6267;&#x884C;&#xFF0C;&#x7136;&#x540E;&#x52A0;&#x8F7D;&#x5F15;&#x5BFC;&#x7A0B;&#x5E8F;&#x5230;<code>RAM</code>&#xFF1B;</li>
<li>Boot Loader&#xFF1A;&#x8FD9;&#x662F;&#x542F;&#x52A8;Android&#x7CFB;&#x7EDF;&#x4E4B;&#x524D;&#x7684;&#x5F15;&#x5BFC;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x68C0;&#x67E5;RAM&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x786C;&#x4EF6;&#x53C2;&#x6570;&#x7B49;&#x529F;&#x80FD;&#x3002;</li>
</ul>
<h3 id="linux&#x5185;&#x6838;&#x5C42;"><a name="linux&#x5185;&#x6838;&#x5C42;" class="anchor-navigation-ex-anchor" href="#linux&#x5185;&#x6838;&#x5C42;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.2. Linux&#x5185;&#x6838;&#x5C42;</h3>
<p>Android&#x5E73;&#x53F0;&#x7684;&#x57FA;&#x7840;&#x662F;Linux&#x5185;&#x6838;&#xFF0C;&#x6BD4;&#x5982;ART&#x865A;&#x62DF;&#x673A;&#x6700;&#x7EC8;&#x8C03;&#x7528;&#x5E95;&#x5C42;Linux&#x5185;&#x6838;&#x6765;&#x6267;&#x884C;&#x529F;&#x80FD;&#xFF0C;<strong>&#x81EA;&#x7136;</strong></p>
<ul>
<li>&#x542F;&#x52A8;Kernel&#x7684;swapper&#x8FDB;&#x7A0B;(pid=0)&#xFF1A;&#x8BE5;&#x8FDB;&#x7A0B;&#x53C8;&#x79F0;&#x4E3A;idle&#x8FDB;&#x7A0B;, &#x7CFB;&#x7EDF;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;Kernel&#x7531;&#x65E0;&#x5230;&#x6709;&#x5F00;&#x521B;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;, &#x7528;&#x4E8E;&#x521D;&#x59CB;&#x5316;&#x8FDB;&#x7A0B;&#x7BA1;&#x7406;&#x3001;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#xFF0C;<del><strong>&#x52A0;&#x8F7D; &#x9A71;&#x52A8;</strong>&#xFF08;Display&#x3001;Camera&#x3001;Binder&#xFF09;&#x7B49;&#x76F8;&#x5173;&#x5DE5;&#x4F5C;</del>&#xFF0C;<strong>&#x81EA;&#x7136;</strong>&#xFF1B;</li>
<li>&#x542F;&#x52A8;kthreadd&#x8FDB;&#x7A0B;&#xFF08;pid=2&#xFF09;&#xFF1A;&#x662F;Linux&#x7CFB;&#x7EDF;&#x7684;&#x5185;&#x6838;&#x8FDB;&#x7A0B;&#xFF0C;&#x4F1A;&#x521B;&#x5EFA;&#x5185;&#x6838;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;kworkder&#xFF0C;&#x8F6F;&#x4E2D;&#x65AD;&#x7EBF;&#x7A0B;ksoftirqd&#xFF0C;thermal&#x7B49;&#x5185;&#x6838;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3002;<code>kthreadd&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x5185;&#x6838;&#x8FDB;&#x7A0B;&#x7684;&#x9F3B;&#x7956;</code>&#x3002;----&#x300B;<font color="red">TODO:  &#x4E0D;&#x61C2;</font></li>
</ul>
<h3 id="&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42;-hal"><a name="&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42;-hal" class="anchor-navigation-ex-anchor" href="#&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42;-hal"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.3. &#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42; (HAL)</h3>
<p>&#x786C;&#x4EF6;&#x62BD;&#x8C61;&#x5C42; (HAL) <font color="red">&#x63D0;&#x4F9B;&#x6807;&#x51C6;&#x63A5;&#x53E3;</font>&#xFF0C;HAL&#x5305;&#x542B;&#x591A;&#x4E2A;&#x5E93;&#x6A21;&#x5757;&#xFF0C;&#x5176;&#x4E2D;&#x6BCF;&#x4E2A;&#x6A21;&#x5757;&#x90FD;&#x4E3A;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x786C;&#x4EF6;&#x7EC4;&#x4EF6;&#x5B9E;&#x73B0;&#x4E00;&#x7EC4;&#x63A5;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;WIFI/&#x84DD;&#x7259;&#x6A21;&#x5757;&#xFF0C;&#x5F53;&#x6846;&#x67B6;API&#x8BF7;&#x6C42;&#x8BBF;&#x95EE;&#x8BBE;&#x5907;&#x786C;&#x4EF6;&#x65F6;&#xFF0C;Android&#x7CFB;&#x7EDF;&#x5C06;&#x4E3A;&#x8BE5;&#x786C;&#x4EF6;&#x52A0;&#x8F7D;&#x76F8;&#x5E94;&#x7684;&#x5E93;&#x6A21;&#x5757;&#x3002;</p>
<h3 id="android-runtime--&#x7CFB;&#x7EDF;&#x5E93;"><a name="android-runtime--&#x7CFB;&#x7EDF;&#x5E93;" class="anchor-navigation-ex-anchor" href="#android-runtime--&#x7CFB;&#x7EDF;&#x5E93;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.4. Android Runtime &amp; &#x7CFB;&#x7EDF;&#x5E93;</h3>
<p>&#x6BCF;&#x4E2A;&#x5E94;&#x7528;&#x90FD;&#x5728;&#x5176;&#x81EA;&#x5DF1;&#x7684;&#x8FDB;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;&#xFF0C;&#x90FD;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x865A;&#x62DF;&#x673A;&#x5B9E;&#x4F8B;&#x3002;ART&#x901A;&#x8FC7;&#x6267;&#x884C;DEX&#x6587;&#x4EF6;&#x53EF;&#x5728;&#x8BBE;&#x5907;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x673A;&#xFF0C;DEX&#x6587;&#x4EF6;&#x662F;&#x4E00;&#x79CD;&#x4E13;&#x4E3A;Android&#x8BBE;&#x8BA1;&#x7684;&#x5B57;&#x8282;&#x7801;&#x683C;&#x5F0F;&#x6587;&#x4EF6;&#xFF0C;&#x7ECF;&#x8FC7;&#x4F18;&#x5316;&#xFF0C;&#x4F7F;&#x7528;&#x5185;&#x5B58;&#x5F88;&#x5C11;&#x3002;ART&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x5305;&#x62EC;&#xFF1A;&#x9884;&#x5148;(AOT)&#x548C;&#x5373;&#x65F6;(JIT)&#x7F16;&#x8BD1;&#xFF0C;&#x4F18;&#x5316;&#x7684;&#x5783;&#x573E;&#x56DE;&#x6536;(GC)&#xFF0C;&#x4EE5;&#x53CA;&#x8C03;&#x8BD5;&#x76F8;&#x5173;&#x7684;&#x652F;&#x6301;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7684;Native&#x7CFB;&#x7EDF;&#x5E93;&#x4E3B;&#x8981;&#x5305;&#x62EC;init&#x5B75;&#x5316;&#x6765;&#x7684;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#x3001;HAL&#x5C42;&#x4EE5;&#x53CA;&#x5F00;&#x673A;&#x52A8;&#x753B;&#x7B49;&#x3002;&#x542F;&#x52A8;init&#x8FDB;&#x7A0B;(pid=1),&#x662F;Linux&#x7CFB;&#x7EDF;&#x7684;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#xFF0C;<font color="green"><strong>&#x8BB0;&#x5FC6;&#xFF1A;</strong></font><code>init&#x8FDB;&#x7A0B;&#x662F;&#x6240;&#x6709;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x7684;&#x9F3B;&#x7956;</code>&#x3002;</p>
<ul>
<li>init&#x8FDB;&#x7A0B;&#x4F1A;&#x5B75;&#x5316;&#x51FA;ueventd&#x3001;logd&#x3001;healthd&#x3001;installd&#x3001;adbd&#x3001;lmkd&#x7B49;&#x7528;&#x6237;&#x5B88;&#x62A4;&#x8FDB;&#x7A0B;&#xFF1B;</li>
<li>init&#x8FDB;&#x7A0B;&#x8FD8;&#x542F;&#x52A8;<code>servicemanager</code>(binder&#x670D;&#x52A1;&#x7BA1;&#x5BB6;)&#x3001;<code>bootanim</code>(&#x5F00;&#x673A;&#x52A8;&#x753B;)&#x7B49;&#x91CD;&#x8981;&#x670D;&#x52A1;</li>
<li>init&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x51FA;Zygote&#x8FDB;&#x7A0B;&#xFF0C;Zygote&#x8FDB;&#x7A0B;&#x662F;Android&#x7CFB;&#x7EDF;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;Java&#x8FDB;&#x7A0B;(&#x5373;&#x865A;&#x62DF;&#x673A;&#x8FDB;&#x7A0B;)&#xFF0C;<code>Zygote&#x662F;&#x6240;&#x6709;Java&#x8FDB;&#x7A0B;&#x7684;&#x7236;&#x8FDB;&#x7A0B;</code>&#xFF0C;Zygote&#x8FDB;&#x7A0B;&#x672C;&#x8EAB;&#x662F;&#x7531;init&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x800C;&#x6765;&#x7684;&#x3002;</li>
</ul>
<h3 id="framework&#x5C42;"><a name="framework&#x5C42;" class="anchor-navigation-ex-anchor" href="#framework&#x5C42;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.5. Framework&#x5C42;</h3>
<ul>
<li>Zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x662F;&#x7531;init&#x8FDB;&#x7A0B;&#x901A;&#x8FC7;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#x540E;fork&#x751F;&#x6210;&#x7684;&#xFF0C;Zygote&#x8FDB;&#x7A0B;&#x4E3B;&#x8981;&#x5305;&#x542B;&#xFF1A;<ul>
<li>&#x52A0;&#x8F7D;ZygoteInit&#x7C7B;&#xFF0C;&#x6CE8;&#x518C;Zygote Socket&#x670D;&#x52A1;&#x7AEF;&#x5957;&#x63A5;&#x5B57;</li>
<li>&#x52A0;&#x8F7D;&#x865A;&#x62DF;&#x673A;</li>
<li>&#x63D0;&#x524D;&#x52A0;&#x8F7D;&#x7C7B;preloadClasses</li>
<li>&#x63D0;&#x524D;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preloadResouces</li>
</ul>
</li>
<li>System Server&#x8FDB;&#x7A0B;&#xFF0C;&#x662F;&#x7531;Zygote&#x8FDB;&#x7A0B;fork&#x800C;&#x6765;&#xFF0C;<code>System Server&#x662F;Zygote&#x5B75;&#x5316;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</code>&#xFF0C;System Server&#x8D1F;&#x8D23;&#x542F;&#x52A8;&#x548C;&#x7BA1;&#x7406;&#x6574;&#x4E2A;Java framework&#xFF0C;&#x5305;&#x542B;ActivityManager&#xFF0C;WindowManager&#xFF0C;PackageManager&#xFF0C;PowerManager&#x7B49;&#x670D;&#x52A1;&#x3002;</li>
<li>Media Server&#x8FDB;&#x7A0B;&#xFF0C;&#x662F;&#x7531;init&#x8FDB;&#x7A0B;fork&#x800C;&#x6765;&#xFF0C;&#x8D1F;&#x8D23;&#x542F;&#x52A8;&#x548C;&#x7BA1;&#x7406;&#x6574;&#x4E2A;C++ framework&#xFF0C;&#x5305;&#x542B;AudioFlinger&#xFF0C;Camera Service&#x7B49;&#x670D;&#x52A1;&#x3002;</li>
</ul>
<h3 id="app&#x5C42;"><a name="app&#x5C42;" class="anchor-navigation-ex-anchor" href="#app&#x5C42;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.6. App&#x5C42;</h3>
<ul>
<li>Zygote&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x51FA;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;App&#x8FDB;&#x7A0B;&#x662F;Launcher&#xFF0C;&#x8FD9;&#x662F;&#x7528;&#x6237;&#x770B;&#x5230;&#x7684;&#x684C;&#x9762;App&#xFF1B;</li>
<li>Zygote&#x8FDB;&#x7A0B;&#x8FD8;&#x4F1A;&#x521B;&#x5EFA;Browser&#xFF0C;Phone&#xFF0C;Email&#x7B49;App&#x8FDB;&#x7A0B;&#xFF0C;&#x6BCF;&#x4E2A;App&#x81F3;&#x5C11;&#x8FD0;&#x884C;&#x5728;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E0A;&#x3002;</li>
<li>&#x6240;&#x6709;&#x7684;App&#x8FDB;&#x7A0B;&#x90FD;&#x662F;&#x7531;Zygote&#x8FDB;&#x7A0B;fork&#x751F;&#x6210;&#x7684;&#x3002;</li>
</ul>
<h3 id="&#x5899;-syscall"><a name="&#x5899;-syscall" class="anchor-navigation-ex-anchor" href="#&#x5899;-syscall"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.7. &#x5899; Syscall</h3>
<ul>
<li>Native&#x4E0E;Kernel&#x4E4B;&#x95F4;&#x6709;&#x4E00;&#x5C42;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;(SysCall)&#x5C42;&#xFF0C;&#x89C1;<a href="http://gityuan.com/2016/05/21/syscall/" target="_blank">Linux&#x7CFB;&#x7EDF;&#x8C03;&#x7528;(Syscall)&#x539F;&#x7406;</a>;</li>
</ul>
<p>&#x200B;    Q&#xFF1A;<strong>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;Syscall&#x5899;&#xFF1F;</strong>&#xFF08;&#x7B49;&#x4EF7;&#x95EE;&#x9898;&#xFF1A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x548C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF1F;&#xFF09;</p>
<p>&#x200B;    A&#xFF1A;<font color="red">&#x5B83;&#x786E;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x9053;&#x5899;</font>&#xFF0C;&#x76EE;&#x7684;&#x4E5F;&#x662F;&#x5899;&#x7684;&#x4F5C;&#x7528;&#xFF1A;</p>
<p>&#x200B;              -<font color="red">&#x4FDD;&#x62A4;&#x786C;&#x4EF6;&#x8D44;&#x6E90;</font>&#x4E0D;&#x4F1A;&#x88AB;&#x968F;&#x4FBF;&#x8BBF;&#x95EE;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x5185;&#x6838;&#x7A33;&#x5B9A;&#x6027; &#xFF08;&#x7B49;&#x4EF7;&#x7684;&#x8868;&#x8FF0;&#xFF1A;<del>&#x8BA9;&#x7528;&#x6237;&#x6001;&#x7A0B;&#x5E8F;&#x80FD;<strong>&#x53D7;&#x9650;</strong>&#x8BBF;&#x95EE;&#x786C;&#x4EF6;&#x8BBE;&#x5907;&#xFF0C;&#x6BD4;&#x5982;&#x7533;&#x8BF7;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#xFF0C;&#x64CD;&#x4F5C;&#x8BBE;&#x5907;&#x8BFB;&#x5199;&#xFF0C;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x7B49;&#x3002;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x53D1;&#x751F;&#x8BF7;&#x6C42;&#xFF0C;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x8D1F;&#x8D23;&#x6267;&#x884C;&#xFF0C;&#x8FD9;&#x4E9B;&#x63A5;&#x53E3;&#x4FBF;&#x662F;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x548C;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#x5171;&#x540C;&#x8BC6;&#x522B;&#x7684;&#x6865;&#x6881;&#xFF0C;&#x8FD9;&#x91CC;&#x63D0;&#x5230;&#x4E24;&#x4E2A;&#x5B57;&#x201C;&#x53D7;&#x9650;&#x201D;&#xFF0C;&#x662F;&#x7531;&#x4E8E;&#x4E3A;&#x4E86;&#x4FDD;&#x8BC1;&#x5185;&#x6838;&#x7A33;&#x5B9A;&#x6027;&#xFF0C;&#x800C;&#x4E0D;&#x80FD;&#x8BA9;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7A0B;&#x5E8F;&#x968F;&#x610F;&#x66F4;&#x6539;&#x7CFB;&#x7EDF;&#xFF0C;&#x5FC5;&#x987B;&#x662F;&#x5185;&#x6838;&#x5BF9;&#x5916;&#x5F00;&#x653E;&#x7684;&#x4E14;&#x6EE1;&#x8DB3;&#x6743;&#x9650;&#x7684;&#x7A0B;&#x5E8F;&#x624D;&#x80FD;&#x8C03;&#x7528;&#x76F8;&#x5E94;&#x63A5;&#x53E3;-----<a href="http://gityuan.com/2016/05/21/syscall/" target="_blank">http://gityuan.com/2016/05/21/syscall/</a></del>&#xFF09;</p>
<p><img src="InitSystem.assets/image-20230913010341708.png" alt="image-20230913010341708"></p>
<p>&#x4E00;&#x4E9B;&#x8BA4;&#x77E5;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;native&#x4EE3;&#x7801;&#x4E5F;&#x662F;&#x7528;&#x6237;&#x6001;</p>
<p>2&#x3001;APP&#x3001;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x90FD;&#x662F;&#x7528;&#x6237;&#x6001;</p>
<p>3&#x3001;APP &#x6253;&#x5F00;&#x6587;&#x4EF6; ----&gt; JVM ----&gt; native ---&gt; Syscall  ---&gt; &#x5185;&#x6838; ---&gt; &#x9A71;&#x52A8;</p>
<p>&#x200B;    <strong>&#x4EE5;&#x4E0A;&#x6D41;&#x7A0B;&#xFF0C;&#x4E0D;&#x6D89;&#x53CA;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;</strong></p>
</blockquote>
<p>&#x5173;&#x4E8E;&#x7EBF;&#x7A0B;&#xFF1A;</p>
<blockquote>
<p>-<font color="red">Syscall&#x5899; &#x9694;&#x79BB;&#x7684;&#x662F;&#x4EE3;&#x7801;&#xFF0C;&#x4E0D;&#x662F;&#x7EBF;&#x7A0B;&#x3002;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;</font>&#x3002;&#xFF08;&#x5373;&#xFF1A;<del>&#x7EBF;&#x7A0B;&#x7684;&#x7528;&#x6237;&#x6001;&#x548C;&#x5185;&#x6838;&#x6001;&#x6307;&#x7684;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x4E0D;&#x540C;&#x7684;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x3002;&#x7528;&#x6237;&#x6001;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x5185;&#x6838;&#x6001;&#x662F;&#x5185;&#x6838;&#x4EE3;&#x7801;&#x3001;&#x8BBE;&#x5907;&#x9A71;&#x52A8;&#x4EE3;&#x7801;&#x7B49;&#x8FD0;&#x884C;&#x5728;&#x7EBF;&#x7A0B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x4E2D;&#x65AD;&#x548C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4F1A;&#x5C06;&#x6267;&#x884C;&#x6743;&#x4EA4;&#x7ED9;&#x5185;&#x6838;&#x6001;&#x4EE3;&#x7801;&#x3002;</del> &#xFF09;</p>
</blockquote>
<p>&#x5177;&#x4F53;&#x7684; Syscall &#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x89C1;&#x300A;linux&#x300B;</p>
<h3 id="&#x5899;jni"><a name="&#x5899;jni" class="anchor-navigation-ex-anchor" href="#&#x5899;jni"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.8. &#x5899;JNI</h3>
<p>Java&#x5C42;&#x4E0E;Native(C/C++)&#x5C42;&#x4E4B;&#x95F4;&#x7684;&#x7EBD;&#x5E26;JNI&#xFF0C;&#x89C1;<a href="http://gityuan.com/2016/05/28/android-jni/" target="_blank">Android JNI&#x539F;&#x7406;&#x5206;&#x6790;</a>&#x3002;</p>
<h3 id="&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;"><a name="&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;" class="anchor-navigation-ex-anchor" href="#&#x8FDB;&#x7A0B;&#x5173;&#x7CFB;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.9. &#x8FDB;&#x7A0B;&#x5173;&#x7CFB;</h3>
<pre class="language-"><code class="lang-cpp"><span class="token comment">// ps -ef &#x663E;&#x793A;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x8FDB;&#x7A0B;</span>
UID            PID  PPID C STIME TTY          TIME CMD
root             <span class="token number">1</span>     <span class="token number">0</span> <span class="token number">0</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">36</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02</span> init <span class="token comment">// &#x4E00;&#x53F7;&#x8FDB;&#x7A0B;&#xFF0C;&#x7236;&#x8FDB;&#x7A0B;PPID 0&#x53F7;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
root            <span class="token number">16</span>     <span class="token number">2</span> <span class="token number">0</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">36</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">04</span> <span class="token punctuation">[</span>rcuc<span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  
root           <span class="token number">623</span>     <span class="token number">1</span> <span class="token number">0</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">39</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">09</span> zygote64  <span class="token comment">//Zygote &#x8FDB;&#x7A0B;</span>
root           <span class="token number">624</span>     <span class="token number">1</span> <span class="token number">0</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">30</span><span class="token operator">:</span><span class="token number">39</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">07</span> zygote
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
system        <span class="token number">8951</span>   <span class="token number">623</span> <span class="token number">0</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">30</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>settings <span class="token comment">// &#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5728; Zygote &#x8FDB;&#x7A0B; &#x4E4B;&#x540E;</span>
u0_a81        <span class="token number">9022</span>   <span class="token number">623</span> <span class="token number">0</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">31</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>dialer
u0_a37       <span class="token number">12510</span>   <span class="token number">623</span> <span class="token number">0</span> <span class="token number">13</span><span class="token operator">:</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">05</span> <span class="token operator">?</span>     <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">01</span> android<span class="token punctuation">.</span>process<span class="token punctuation">.</span>acore
</code></pre>
<p>ps &#x663E;&#x793A;&#x8FDB;&#x7A0B;&#x53F7;: </p>
<ol>
<li>init&#x662F;1&#x53F7;&#x8FDB;&#x7A0B;&#xFF08;&#x81EA;&#x7136;&#xFF0C;<del>&#x5176;&#x7236;&#x8FDB;&#x7A0B;PPID = 0&#x53F7;&#x8FDB;&#x7A0B;</del>&#xFF09;</li>
<li>&#x81EA;&#x7136;&#xFF0C;<del>0&#x53F7;&#x8FDB;&#x7A0B;&#x5C5E;&#x4E8E; &#x5185;&#x6838;&#x6001;&#xFF0C;&#x6240;&#x4EE5;ps&#x6CA1;&#x6709;&#x663E;&#x793A;</del></li>
<li>Linux&#x6574;&#x4E2A;&#x8FDB;&#x7A0B;&#x6811;&#x5F62;&#x6210;&#xFF1A;TODO</li>
<li>Zygote &#x8FDB;&#x7A0B;:   <del>&#x6240;&#x6709;java&#x8FDB;&#x7A0B;(&#x7CFB;&#x7EDF;+APP&#x90FD;)  &#x5B75;&#x5316;&#x673A;</del>&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x7687;&#x5983;</li>
</ol>
<p>Init &#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;: x &#x53EF;&#x6267;&#x884C; ---&#x300B; &#x5BF9;&#x4E8E;cpp/java&#x7F16;&#x8BD1;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x4E14;&#x53EF;&#x6267;&#x884C;------&gt;  &#x81EA;&#x7136;&#xFF0C;&#x4E00;&#x5B9A;&#x542B;main&#x51FD;&#x6570;</p>
<h2 id="&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;"><a name="&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;" class="anchor-navigation-ex-anchor" href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x7B80;&#x4ECB;</h2>
<h2 id="------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------"><a name="------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------" class="anchor-navigation-ex-anchor" href="#------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------"><i class="fa fa-link" aria-hidden="true"></i></a>2.4. -------&#x6D41;&#x7A0B;start&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;-------</h2>
<h2 id="&#x5185;&#x6838;&#x52A0;&#x8F7D;"><a name="&#x5185;&#x6838;&#x52A0;&#x8F7D;" class="anchor-navigation-ex-anchor" href="#&#x5185;&#x6838;&#x52A0;&#x8F7D;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5. &#x5185;&#x6838;&#x52A0;&#x8F7D;</h2>
<p>linux&#x5185;&#x6838;&#x542F;&#x52A8;&#xFF08;&#x518D;&#x5177;&#x4F53;&#xFF1A;&#xFF09;&#xFF0C;&#x5305;&#x62EC;&#x9A71;&#x52A8;&#x52A0;&#x8F7D;&#xFF0C;&#x4F8B;&#x5982;Binder&#x9A71;&#x52A8;</p>
<h2 id="0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;"><a name="0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6. 0&#x53F7;&#x8FDB;&#x7A0B;fork&#x51FA;init&#x8FDB;&#x7A0B;</h2>
<p>&#x5F00;&#x5929;&#x8F9F;&#x5730;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;   0&#x53F7;&#x8FDB;&#x7A0B;&#xFF08;swapper&#xFF09;&#xFF0C;&#x5185;&#x6838;&#x8FDB;&#x7A0B;</p>
<p>&#x9A71;&#x52A8;&#x52A0;&#x8F7D;&#x7684;&#x6D41;&#x7A0B;</p>
<p>&#x5B75;&#x5316;&#x51FA;init&#x8FDB;&#x7A0B;  ----&#x300B;<del><font color="red">&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x59CB;&#x7956;&#x8FDB;&#x7A0B;</font></del>&#xFF08;&#x975E;&#x5185;&#x6838;&#x8FDB;&#x7A0B;&#xFF0C;&#x81EA;&#x7136;&#xFF09;</p>
<h2 id="&#x5B89;&#x5353;init&#x8FDB;&#x7A0B;-&#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;"><a name="&#x5B89;&#x5353;init&#x8FDB;&#x7A0B;-&#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;" class="anchor-navigation-ex-anchor" href="#&#x5B89;&#x5353;init&#x8FDB;&#x7A0B;-&#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7. &#x5B89;&#x5353;init&#x8FDB;&#x7A0B; &#x6240;&#x505A;&#x4E09;&#x4EF6;&#x4E8B;</h2>
<p><strong>init &#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#xFF0C;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x4EE5;&#x4E0B;&#x4E09;&#x4EF6;&#x4E8B;&#xFF1A;</strong></p>
<blockquote>
<p>1&#x2019;&#x3001;&#x76EE;&#x5F55;&#x76F8;&#x5173;:  &#x521B;&#x5EFA;&#xFF08;mkdir&#xFF09;&#x548C;&#x6302;&#x8F7D;&#xFF08;mount&#xFF09;&#x542F;&#x52A8;&#x6240;&#x9700;&#x7684;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#xFF1B;</p>
<p>2&#x3001;&#x670D;&#x52A1;&#x5C5E;&#x6027;&#xFF1F;&#xFF1F;&#xFF1F;&#xFF1F;&#xFF1A;&#x521D;&#x59CB;&#x5316;&#x548C;&#x542F;&#x52A8;&#x5C5E;&#x6027;&#x670D;&#x52A1;&#xFF08;property service&#xFF09;</p>
<p>3&#x3001;&#x89E3;&#x6790;.rc&#x6587;&#x4EF6;&#xFF0C;<strong>&#x5E76;&#x6309;&#x6761;&#x4EF6;&#x542F;&#x52A8;</strong>&#xFF1A; &#x89E3;&#x6790; init.rc &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x5E76;&#x542F;&#x52A8; Zygote &#x8FDB;&#x7A0B;</p>
<p>&#x53C2;&#x8003;&#xFF1A; <a href="https://blog.csdn.net/xingyu19911016/article/details/127451545" target="_blank">https://blog.csdn.net/xingyu19911016/article/details/127451545</a></p>
</blockquote>
<h2 id="init&#x8FDB;&#x7A0B;&#x4E4B;-------&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;"><a name="init&#x8FDB;&#x7A0B;&#x4E4B;-------&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;" class="anchor-navigation-ex-anchor" href="#init&#x8FDB;&#x7A0B;&#x4E4B;-------&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8. init&#x8FDB;&#x7A0B;&#x4E4B; ------&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;</h2>
<h3 id="init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;"><a name="init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;initrc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.1. init&#x8FDB;&#x7A0B;&#x89E3;&#x6790;init.rc&#x6587;&#x4EF6;&#xFF0C;&#x62C9;&#x8D77;&#x5404;&#x79CD;&#x8FDB;&#x7A0B;</h3>
<p>&#x4E09;&#x89D2;&#x5EA6;&#xFF1A;</p>
<p>1&#x3001;&#x4ECE;&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#xFF1A;&#x57FA;&#x4E8E;0&#x5C42;&#x56FE;&#xFF0C;<del>init&#x8FDB;&#x7A0B;&#x7531;0&#x53F7;&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x800C;&#x6765;</del> &#x81EA;&#x7136;</p>
<p>2&#x3001;<del>&#x4ECE;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF1A;&#x6839;&#x76EE;&#x5F55;&#x4E0B;init&#x6587;&#x4EF6;&#x6267;&#x884C;</del></p>
<p><img src="InitSystem.assets/image-20221203130534818.png" alt="image-20221203130534818"></p>
<p>3&#x3001;&#x4ECE;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#xFF1A;</p>
<pre class="language-"><code class="lang-cpp"><span class="token comment">//system/core/init/init.cpp</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">LoadBootScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bootscript<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/init.rc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x89E3;&#x6790;init.rc</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/system/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            late_import_paths<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token string">&quot;/system/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/product/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            late_import_paths<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token string">&quot;/product/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/product_services/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            late_import_paths<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token string">&quot;/product_services/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/odm/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            late_import_paths<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token string">&quot;/odm/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parser<span class="token punctuation">.</span><span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token string">&quot;/vendor/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            late_import_paths<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span><span class="token string">&quot;/vendor/etc/init&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p>init.rc &#x547D;&#x4EE4;&#x6587;&#x4EF6; :</p>
<pre class="language-"><code class="lang-cpp"><span class="token keyword">import</span> <span class="token operator">/</span>init<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>rc  <span class="token comment">// &#x7ED9;linux&#x7CFB;&#x7EDF;&#xFF0C;&#x8BBE;&#x7F6E;&#x4E86;&#x5404;&#x79CD;&#x73AF;&#x5883;&#x53D8;&#x91CF;</span>
<span class="token keyword">import</span> <span class="token operator">/</span>init<span class="token punctuation">.</span>usb<span class="token punctuation">.</span>rc
<span class="token keyword">import</span> <span class="token operator">/</span>init<span class="token punctuation">.</span>$<span class="token punctuation">{</span>ro<span class="token punctuation">.</span>hardware<span class="token punctuation">}</span><span class="token punctuation">.</span>rc
<span class="token keyword">import</span> <span class="token operator">/</span>vendor<span class="token operator">/</span>etc<span class="token operator">/</span>init<span class="token operator">/</span>hw<span class="token operator">/</span>init<span class="token punctuation">.</span>$<span class="token punctuation">{</span>ro<span class="token punctuation">.</span>hardware<span class="token punctuation">}</span><span class="token punctuation">.</span>rc
<span class="token keyword">import</span> <span class="token operator">/</span>init<span class="token punctuation">.</span>usb<span class="token punctuation">.</span>configfs<span class="token punctuation">.</span>rc
<span class="token keyword">import</span> <span class="token operator">/</span>init<span class="token punctuation">.</span>$<span class="token punctuation">{</span>ro<span class="token punctuation">.</span>zygote<span class="token punctuation">}</span><span class="token punctuation">.</span>rc  <span class="token comment">//import</span>

<span class="token module">start</span> zygote  <span class="token comment">//&#x3010;&#x3011;&#x542F;&#x52A8;zygote&#x8FDB;&#x7A0B;</span>
start servicemanager  <span class="token comment">//&#x3010;&#x3011;&#x542F;&#x52A8;servicemanager</span>
</code></pre>
<pre class="language-"><code class="lang-cpp"><span class="token comment">// init.zygote64_32.rc</span>

<span class="token comment">// &#x3010;&#x3011;&#x5B9A;&#x4E49;&#x4E86;&#x670D;&#x52A1;:zygote</span>
service zygote <span class="token operator">/</span>system<span class="token operator">/</span>bin<span class="token operator">/</span>app_process64 <span class="token operator">-</span>Xzygote <span class="token operator">/</span>system<span class="token operator">/</span>bin <span class="token operator">--</span>zygote <span class="token operator">--</span>start<span class="token operator">-</span>system<span class="token operator">-</span>server <span class="token operator">--</span>socket<span class="token operator">-</span>name<span class="token operator">=</span>zygote   
    <span class="token comment">//&#x3010;1&#x3011; /system/bin/app_process64</span>
    <span class="token comment">// &#x3010;2&#x3011; --zygote  </span>
    <span class="token comment">// &#x3010;3&#x3011; --start-system-server  &#x542F;&#x52A8; SystemServer</span>

    <span class="token keyword">class</span> <span class="token class-name">main</span>
    priority <span class="token operator">-</span><span class="token number">20</span>
    user root  <span class="token comment">// /&#x8BF4;&#x660E;&#x4EE5;&#x7528;&#x6237;root&#x8EAB;&#x4EFD;&#x8FD0;&#x884C;&#xFF0C;&#x81EA;&#x7136;</span>
    group root readproc reserved_disk
    socket zygote stream <span class="token number">660</span> root system  <span class="token comment">//&#x3010;&#x3011; //socket&#x5173;&#x952E;&#x5B57;&#x8868;&#x793A;&#x8FD9;&#x4E2A;zygote&#x8FDB;&#x7A0B;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x540D;&#x79F0;&#x4E3A;&quot;zygote&quot;&#x7684;socket&#x8D44;&#x6E90;&#xFF0C;&#x8FD9;&#x6837;&#xFF0C;&#x7CFB;&#x7EDF;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5728;/dev/socket&#x76EE;&#x5F55;&#x4E0B;&#x770B;&#x5230;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A;zygote&#x7684;&#x6587;&#x4EF6;&#x3002;&#x8FD9;&#x91CC;&#x5B9A;&#x4E49;&#x7684;socket&#x7684;&#x7C7B;&#x578B;&#x4E3A;unix domain socket&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x6765;&#x4F5C;&#x672C;&#x5730;&#x8FDB;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x7528;&#x7684;</span>
    socket usap_pool_primary stream <span class="token number">660</span> root system
    onrestart write <span class="token operator">/</span>sys<span class="token operator">/</span>android_power<span class="token operator">/</span>request_state wake
    onrestart write <span class="token operator">/</span>sys<span class="token operator">/</span>power<span class="token operator">/</span>state on
    onrestart restart audioserver
    onrestart restart cameraserver
    onrestart restart media  <span class="token comment">// &#x5F53;zygote&#x91CD;&#x542F;&#x65F6;,&#x5219;&#x4F1A;&#x91CD;&#x542F;media ---&gt; &#x80CC;&#x540E;&#x7684;&#x673A;&#x5236;&#x662F;&#x5565;&#xFF0C;&#x5982;&#x4F55;&#x4FDD;&#x8BC1;&#x7684;&#xFF1F;</span>
    onrestart restart netd
    onrestart restart wificond
    writepid <span class="token operator">/</span>dev<span class="token operator">/</span>cpuset<span class="token operator">/</span>foreground<span class="token operator">/</span>tasks

<span class="token comment">// &#x540C;&#x7406; servicemanager</span>
<span class="token comment">// frameworks/native/cmds/servicemanager/servicemanager.rc</span>
service servicemanager <span class="token operator">/</span>system<span class="token operator">/</span>bin<span class="token operator">/</span>servicemanager
</code></pre>
<p>&#x5177;&#x4F53;&#x5982;&#x4F55;&#x542F;&#x52A8;&#xFF1F; TODO:  &#x5373; &#x547D;&#x4EE4;&#x5982;&#x4F55;&#x6267;&#x884C;&#xFF0C;&#x5982;&#x4F55;&#x751F;&#x6210;&#x65B0;&#x8FDB;&#x7A0B;&#xFF1F;</p>
<p>&#x7531;&#x3010;1&#x3011;&#x53EF;&#x89C1;&#xFF0C;zygote&#x8FDB;&#x7A0B; &#x8FD0;&#x884C;&#x7684;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x662F;  app_process64&#xFF08;<strong>&#x539F;&#x6765;&#x540D;&#x5B57;&#x5C31;&#x53EB; app process &#x89C1; attach</strong>)&#xFF09;</p>
<p><img src="InitSystem.assets/image-20221203190445252.png" alt="image-20221203190445252"></p>
<p>&#x3010;2&#x3011; &#x5BF9;&#x5E94;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-cpp">    <span class="token keyword">if</span> <span class="token punctuation">(</span>zygote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        runtime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.internal.os.ZygoteInit&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> zygote<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x8865;&#x5145;rc&#x6587;&#x4EF6;&#x77E5;&#x8BC6;&#xFF1A;TODO
  <a href="https://wenku.baidu.com/view/2955b4df740bf78a6529647d27284b73f24236c7.html?_wkts_=1670062987073&amp;bdQuery=%E5%AE%89%E5%8D%93rc%E6%96%87%E4%BB%B6+%E6%A0%BC%E5%BC%8F" target="_blank">https://wenku.baidu.com/view/2955b4df740bf78a6529647d27284b73f24236c7.html?_wkts_=1670062987073&amp;bdQuery=%E5%AE%89%E5%8D%93rc%E6%96%87%E4%BB%B6+%E6%A0%BC%E5%BC%8F</a>     android&#x4EE3;&#x7801;.rc<strong>&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x89E3;&#x6790;</strong>
<a href="https://www.jb51.net/article/208558.htm" target="_blank">https://www.jb51.net/article/208558.htm</a>    Android ServiceManager&#x7684;&#x542F;&#x52A8;&#x548C;&#x5DE5;&#x4F5C;&#x539F;&#x7406;</p>
<h3 id="&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;"><a name="&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;" class="anchor-navigation-ex-anchor" href="#&#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.8.2. &#x5404;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x62C9;&#x8D77;&#x7684;&#x65F6;&#x5E8F;</h3>
<p><img src="InitSystem.assets/image-20230312001050823.png" alt="image-20230312001050823"></p>
<p><strong>&#x8BB0;&#x5FC6;&#xFF0C;</strong>&#x5927;&#x81F4;&#x987A;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>ServiceManager&#x662F;&#x5728;&#x5404;&#x79CD;Binder&#x670D;&#x52A1;&#x4E4B;&#x524D;&#x8D77;&#x6765;&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x975E;&#x5E38;&#x5408;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x7BA1;&#x7406;</li>
<li>Zygote&#x662F;&#x975E;&#x5E38;&#x9760;&#x540E;&#x7684;&#xFF0C;&#x81EA;&#x7136;&#xFF0C;&#x56E0;&#x4E3A;&#x5148;native&#xFF0C;&#x6700;&#x540E;&#x8FDB;&#x5165;java&#x4E16;&#x754C;</li>
</ul>
<p>&#x9A8C;&#x8BC1;&#xFF1A;
&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FDB;&#x7A0B;pid&#x5F97;&#x5230;&#x9A8C;&#x8BC1;</p>
<p>&#x4EE3;&#x7801;&#x5C42;&#x9762;&#x7684;&#x9A8C;&#x8BC1;&#xFF1A;<a href="https://blog.csdn.net/u013463707/article/details/100926522?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-100926522-blog-116968113.pc_relevant_3mothn_strategy_and_data_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-100926522-blog-116968113.pc_relevant_3mothn_strategy_and_data_recovery&amp;utm_relevant_index=1" target="_blank">https://blog.csdn.net/u013463707/article/details/100926522?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-100926522-blog-116968113.pc_relevant_3mothn_strategy_and_data_recovery&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-100926522-blog-116968113.pc_relevant_3mothn_strategy_and_data_recovery&amp;utm_relevant_index=1</a></p>
<pre class="language-"><code class="lang-cpp"><span class="token number">1</span><span class="token punctuation">)</span> early<span class="token operator">-</span>init

    a<span class="token punctuation">)</span> wait_for_coldboot_done
    b<span class="token punctuation">)</span> property_init
    c<span class="token punctuation">)</span> keychord_int
    d<span class="token punctuation">)</span> console_init
    e<span class="token punctuation">)</span> set_init_properties
<span class="token number">2</span><span class="token punctuation">)</span> init
<span class="token number">3</span><span class="token punctuation">)</span> late<span class="token operator">-</span>init
<span class="token number">4</span><span class="token punctuation">)</span> early<span class="token operator">-</span>fs

<span class="token number">5</span><span class="token punctuation">)</span> fs

<span class="token number">6</span><span class="token punctuation">)</span> post<span class="token operator">-</span>fs

    f<span class="token punctuation">)</span> property_service_init
    g<span class="token punctuation">)</span> signal_init
    h<span class="token punctuation">)</span> check_startup
<span class="token number">7</span><span class="token punctuation">)</span> early<span class="token operator">-</span>boot

<span class="token number">8</span><span class="token punctuation">)</span> boot

<span class="token number">9</span><span class="token punctuation">)</span> service
</code></pre>
<p>TODO:
serviceManager&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x3001;surfaceFling&#x6D41;&#x7A0B;</p>
<h2 id="servicemanager&#x542F;&#x52A8;&#x6D41;&#x7A0B;"><a name="servicemanager&#x542F;&#x52A8;&#x6D41;&#x7A0B;" class="anchor-navigation-ex-anchor" href="#servicemanager&#x542F;&#x52A8;&#x6D41;&#x7A0B;"><i class="fa fa-link" aria-hidden="true"></i></a>2.9. serviceManager&#x542F;&#x52A8;&#x6D41;&#x7A0B;</h2>
<h2 id="zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native-main"><a name="zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native-main" class="anchor-navigation-ex-anchor" href="#zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native-main"><i class="fa fa-link" aria-hidden="true"></i></a>2.10. zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;native main</h2>
<p>&#x4E09;&#x89D2;&#x5EA6;&#xFF1A;</p>
<blockquote>
<p>&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#xFF1A;zygote&#x8FDB;&#x7A0B; &#xFF1A;<del><font color="red">java&#x8FDB;&#x7A0B;&#x7684;&#x59CB;&#x7956;&#x8FDB;&#x7A0B;</font></del>&#xFF0C;&#x81EA;&#x7136;</p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF1A;   /system/bin/app_process64 &#xFF0C;&#x81EA;&#x7136;&#xFF0C;&#x56E0;&#x4E3A;&#x53C8;&#x53EB;</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#xFF1A;frameworks/base/cmds/<strong>app_process</strong>/app_main.cpp</p>
<p>&#x4E09;w&#xFF1A;
when&#xFF1A;</p>
<p>what&#xFF1A;</p>
<p>how&#xFF1A;</p>
</blockquote>
<pre class="language-"><code class="lang-cpp"><span class="token comment">//frameworks/base/cmds/app_process/app_main.cpp</span>

<span class="token comment">//zygote&#x8FDB;&#x7A0B;&#x5165;&#x53E3;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//zygote &#x662F;&#x7531;init&#x8FDB;&#x7A0B;fork&#x800C;&#x6765;&#xFF0C;init.rc&#x6587;&#x4EF6;&#x4E2D;&#x4E3A;zygote&#x8FDB;&#x7A0B;&#x8BBE;&#x7F6E;&#x7684;&#x542F;&#x52A8;&#x53C2;&#x6570;&#x5982;&#x4E0B;</span>
    <span class="token comment">//argc = 4</span>
    <span class="token comment">//argv = [-Xzygote, /system/bin, --zygote, --start-system-server]</span>

    AppRuntime <span class="token function">runtime</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x3010;1&#x3011; &#x521B;&#x5EFA;AndroidRuntime&#x5BF9;&#x8C61;&#xFF0C;&#x6CA1;&#x6709;&#x542F;&#x52A8;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>zygote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        runtime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.internal.os.ZygoteInit&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> zygote<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x3010;2&#x3011;runtime&#x542F;&#x52A8; </span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        runtime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.internal.os.RuntimeInit&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> zygote<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Error: no class name or --zygote supplied.\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">app_usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LOG_ALWAYS_FATAL</span><span class="token punctuation">(</span><span class="token string">&quot;app_process: no class name or --zygote supplied.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x3010;1&#x3011; &#x521B;&#x5EFA;AndroidRuntime&#x5BF9;&#x8C61;&#xFF0C;&#x65E0;&#x4ED6;</p>
<p>&#x3010;2&#x3011;runtime&#x542F;&#x52A8;&#xFF0C;runtime&#x5305;&#x62EC;&#x54EA;&#x4E9B;&#x4E1C;&#x897F;&#x5462;&#xFF0C;&#x89C1;&#x4E0B; : </p>
<p>&#xFF08;1&#xFF09;Dalvik&#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;</p>
<p>&#xFF08;2&#xFF09;&#x5229;&#x7528;&#x865A;&#x62DF;&#x5668;&#xFF0C;&#x542F;&#x52A8;java&#x7684;ZygoteInit &#x548C; RuntimeInit</p>
<p>&#x529F;&#x80FD;&#x89C6;&#x89D2;&#xFF1A;TODO
Zygote&#x8FDB;&#x7A0B;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x6A21;&#x5757;&#xFF1A;</p>
<pre class="language-"><code>1. Socket&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x8BE5;Socket&#x670D;&#x52A1;&#x7AEF;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x542F;&#x52A8;&#x65B0;&#x7684;Dalvik&#x8FDB;&#x7A0B;&#x547D;&#x4EE4;&#x3002;

2. Framework&#x5171;&#x4EAB;&#x7C7B;&#x53CA;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#xFF0C;&#x5F53;Zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x540E;&#xFF0C;&#x4F1A;&#x88C5;&#x8F7D;&#x4E00;&#x4E9B;&#x5171;&#x4EAB;&#x7C7B;&#x548C;&#x8D44;&#x6E90;&#xFF0C;&#x5171;&#x4EAB;&#x7C7B;&#x662F;&#x5728;preload-classes&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x662F;&#x5728;preload-resources&#x6587;&#x4EF6;&#x4E2D;&#x5B9A;&#x4E49;&#x3002;&#x56E0;&#x4E3A;&#x5176;&#x4ED6;Dalvik&#x8FDB;&#x7A0B;&#x662F;&#x7531;Zygote&#x8FDB;&#x7A0B;&#x5B75;&#x5316;&#x51FA;&#x6765;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x53EA;&#x8981;Zygote&#x88C5;&#x8F7D;&#x597D;&#x4E86;&#x8FD9;&#x4E9B;&#x7C7B;&#x548C;&#x8D44;&#x6E90;&#x540E;&#xFF0C;&#x65B0;&#x7684;Dalvik&#x8FDB;&#x7A0B;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x88C5;&#x8F7D;&#x8FD9;&#x4E9B;&#x7C7B;&#x548C;&#x8D44;&#x6E90;&#x4E86;&#xFF0C;&#x5B83;&#x4EEC;&#x5171;&#x4EAB;Zygote&#x8FDB;&#x7A0B;&#x7684;&#x8D44;&#x6E90;&#x548C;&#x7C7B;&#x3002;
</code></pre><p>&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="https://blog.csdn.net/yangwen123/article/details/17258023" target="_blank">https://blog.csdn.net/yangwen123/article/details/17258023</a></p>
<h3 id="runtime&#x7684;&#x542F;&#x52A8;runtimestart"><a name="runtime&#x7684;&#x542F;&#x52A8;runtimestart" class="anchor-navigation-ex-anchor" href="#runtime&#x7684;&#x542F;&#x52A8;runtimestart"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.1. runtime&#x7684;&#x542F;&#x52A8;runtime.start</h3>
<p>&#x4E09;&#x89D2;&#x5EA6;&#xFF1A; </p>
<blockquote>
<p>&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#xFF1A;<del>zygote native&#x8FDB;&#x7A0B;&#x4E2D;</del>&#x3002;&#x4E0D;&#x5F97;&#x4E0D;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x90FD;&#x662F;&#x4E3A;java&#x7A0B;&#x5E8F;&#x505A;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x7684;</p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF1A;   /system/lib64/libandroid_runtime.so</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#xFF1A;frameworks/base/core/jni/AndroidRuntime.cpp</p>
</blockquote>
<p><img src="InitSystem.assets/image-20221204003409636.png" alt="image-20221204003409636"></p>
<pre class="language-"><code class="lang-cpp"><span class="token comment">//frameworks/base/core/jni/AndroidRuntime.cpp</span>

<span class="token keyword">void</span> <span class="token class-name">AndroidRuntime</span><span class="token double-colon punctuation">::</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> className<span class="token punctuation">,</span> <span class="token keyword">const</span> Vector<span class="token operator">&lt;</span>String8<span class="token operator">&gt;</span><span class="token operator">&amp;</span> options<span class="token punctuation">,</span> <span class="token keyword">bool</span> zygote<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    JNIEnv<span class="token operator">*</span> env<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startVm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mJavaVM<span class="token punctuation">,</span> <span class="token operator">&amp;</span>env<span class="token punctuation">,</span> zygote<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//&#x3010;1&#x3011;&#x542F;&#x52A8;Dalvik Virtual Machine&#xFF0C;&#x62FF;&#x5230;&#x8FD4;&#x56DE;&#x503C;mJavaVM&#x548C;env</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startReg</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// &#x3010;2&#x3011;Register jni functions.</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    stringClass <span class="token operator">=</span> env<span class="token operator">-&gt;</span><span class="token function">FindClass</span><span class="token punctuation">(</span><span class="token string">&quot;java/lang/String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>stringClass <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    strArray <span class="token operator">=</span> env<span class="token operator">-&gt;</span><span class="token function">NewObjectArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> stringClass<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>strArray <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//&#x521B;&#x5EFA;&#x5B57;&#x7B26;&#x4E32;classNameStr</span>
    <span class="token comment">//&#x5BF9;&#x4E8E;zygote&#x8FDB;&#x7A0B;&#xFF1A;  classNameStr = new String(&quot;com.android.internal.os.ZygoteInit&quot;)</span>
    <span class="token comment">//&#x5BF9;&#x4E8E;&#x542F;&#x52A8;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#xFF1A;classNameStr = new String(&quot;com.android.internal.os.RuntimeInit&quot;)</span>
    classNameStr <span class="token operator">=</span> env<span class="token operator">-&gt;</span><span class="token function">NewStringUTF</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
    env<span class="token operator">-&gt;</span><span class="token function">SetObjectArrayElement</span><span class="token punctuation">(</span>strArray<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classNameStr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">char</span><span class="token operator">*</span> slashClassName <span class="token operator">=</span> <span class="token function">toSlashClassName</span><span class="token punctuation">(</span>className <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">?</span> className <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jclass startClass <span class="token operator">=</span> env<span class="token operator">-&gt;</span><span class="token function">FindClass</span><span class="token punctuation">(</span>slashClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>startClass <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//&#x627E;&#x5230;ZygoteInit&#x7C7B;&#x7684;&#x9759;&#x6001;main&#x65B9;&#x6CD5;&#x7684;jMethodID</span>
        jmethodID startMeth <span class="token operator">=</span> env<span class="token operator">-&gt;</span><span class="token function">GetStaticMethodID</span><span class="token punctuation">(</span>startClass<span class="token punctuation">,</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;([Ljava/lang/String;)V&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            env<span class="token operator">-&gt;</span><span class="token function">CallStaticVoidMethod</span><span class="token punctuation">(</span>startClass<span class="token punctuation">,</span> startMeth<span class="token punctuation">,</span> strArray<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x3010;3&#x3011;&#x901A;&#x8FC7;&#x865A;&#x62DF;&#x673A;&#x8C03;&#x7528;java&#x7684; ZygoteInit&#x7684;main&#x65B9;&#x6CD5;&#xFF0C;zygote&#x8FDB;&#x7A0B;&#x5C31;&#x8FDB;&#x5165;&#x4E86;java&#x4E16;&#x754C;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//.......&#x3010;4&#x3011;........</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x3010;2&#x3011;&#x975E;&#x5E38;&#x81EA;&#x7136;&#xFF0C;&#x53EA;&#x6709;&#x5728;&#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;&#x5B8C;&#x540E;&#xFF0C;&#x624D;&#x80FD;&#x6CE8;&#x518C;jni&#x51FD;&#x6570;&#xFF08;native&#x51FD;&#x6570;&#xFF09;</p>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x3010;3&#x3011;zygote&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x8D2F;&#x901A;native&#x4E0E;java&#x4E16;&#x754C;&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5728;java&#x4FA7;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#xFF08;&#x6B63;&#x5E38;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x4F1A;&#x7ED3;&#x675F;&#xFF09;&#xFF0C;&#x4E0D;&#x4F1A;&#x8D70;&#x3010;4&#x3011;</p>
<p>-<strong><font color="red">&#x8BB0;&#x5FC6;</font>&#xFF1A;</strong>AndroidRuntime::start()&#x4E2D;&#x5B8C;&#x6210;&#xFF1A;&#x5373;<strong>RunTime&#x505A;&#x4E86;&#x5565;&#xFF1F;</strong><a id="sirenwu">&#x56DB;&#x4E2A;&#x4EFB;&#x52A1;</a>
&#x2460;&#x3000;<del>startVm(&amp;mJavaVM, &amp;env) &#x542F;&#x52A8;&#x865A;&#x62DF;&#x673A;</del> &#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5FC5;&#x987B;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;<font color="red">java-native&#x4E4B;&#x95F4;&#x7684;&#x5899;</font>
&#x2461;&#x3000;onVmCreated(env)        &#x865A;&#x62DF;&#x673A;&#x542F;&#x52A8;&#x540E;&#x7684;&#x521D;&#x59CB;&#x5316;
&#x2462;&#x3000;<del>startReg(env)           &#x6CE8;&#x518C;JNI&#x51FD;&#x6570;</del>&#x3002; &#x81EA;&#x7136;&#xFF0C;<font color="red">&#x57FA;&#x4E8E;&#x5899;&#xFF0C;&#x67B6;&#x8D77;&#x68AF;&#x5B50;</font>
&#x2463;&#x3000;<del>env-&gt;CallStaticVoidMethod(startClass, startMeth, strArray) &#x8C03;&#x7528;ZygoteInit&#x7C7B;&#x7684;main&#x51FD;&#x6570;&#x5F00;&#x521B;java&#x4E16;&#x754C;</del>&#x3002;&#x81EA;&#x7136;&#xFF0C;<font color="red">&#x67B6;&#x8D77;&#x68AF;&#x5B50;&#xFF0C;&#x7FFB;&#x8FC7;native&#xFF0C;&#x8FDB;&#x5165;java&#x4E16;&#x754C;&#x5927;&#x95E8;</font></p>
<p>TODO&#xFF1A; </p>
<blockquote>
<p>&#x6240;&#x4EE5;RunTime&#x5C31;&#x662F;&#x6307;&#x7684;&#x865A;&#x62DF;&#x673A;&#x8FD9;&#x4E9B;&#x561B;&#xFF1F;</p>
</blockquote>
<h3 id="&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startvmmjavavm-env"><a name="&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startvmmjavavm-env" class="anchor-navigation-ex-anchor" href="#&#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startvmmjavavm-env"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.2. &#x865A;&#x62DF;&#x673A;&#x7684;&#x542F;&#x52A8;startVm(&amp;mJavaVM, &amp;env)</h3>
<p><a href="#sirenwu">&#x89C1;&#x56DB;&#x4EFB;&#x52A1;</a>  &#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;</p>
<pre class="language-"><code class="lang-cpp"><span class="token keyword">int</span> <span class="token class-name">AndroidRuntime</span><span class="token double-colon punctuation">::</span><span class="token function">startVm</span><span class="token punctuation">(</span>JavaVM<span class="token operator">*</span><span class="token operator">*</span> pJavaVM<span class="token punctuation">,</span> JNIEnv<span class="token operator">*</span><span class="token operator">*</span> pEnv<span class="token punctuation">,</span> <span class="token keyword">bool</span> zygote<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    JavaVMInitArgs initArgs<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>&#x5404;&#x79CD;&#x53C2;&#x6570;&#x7684;&#x89E3;&#x6790;&#x4E0E;&#x521D;&#x59CB;&#x5316;<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment">/*
     * Initialize the VM.
     *
     * The JavaVM* is essentially per-process, and the JNIEnv* is per-thread.
     * If this call succeeds, the VM is ready, and we can start issuing
     * JNI calls.
     */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">JNI_CreateJavaVM</span><span class="token punctuation">(</span>pJavaVM<span class="token punctuation">,</span> pEnv<span class="token punctuation">,</span> <span class="token operator">&amp;</span>initArgs<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//&#x3010;1&#x3011; &#x771F;&#x6B63;&#x521B;&#x5EFA;&#x542F;&#x52A8;javaVM&#x7684;&#x5730;&#x65B9;</span>
        <span class="token function">ALOGE</span><span class="token punctuation">(</span><span class="token string">&quot;JNI_CreateJavaVM failed\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x3010;1&#x3011;&#x62FF;&#x5230;env&#x540E;&#xFF08;&#x81EA;&#x7136;&#xFF0C;<del>native&#x53EF;&#x4EE5;&#x53CD;&#x5C04;&#x8C03;&#x7528;java&#x65B9;&#x6CD5;</del>&#xFF09;&#xFF0C;&#x6807;&#x5FD7;&#x7740;javaVM&#x5DF2;&#x7ECF;&#x521D;&#x59CB;&#x5316;&#x5B8C;&#x6BD5;&#x4E86;</p>
<p>JNI_CreateJavaVM  &#x662F;c&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5177;&#x4F53;&#x505A;&#x4E86;&#x5565;&#xFF1F; TODO</p>
<h3 id="startregenv-&#x6CE8;&#x518C;jni&#x51FD;&#x6570;"><a name="startregenv-&#x6CE8;&#x518C;jni&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#startregenv-&#x6CE8;&#x518C;jni&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.10.3. startReg(env) &#x6CE8;&#x518C;JNI&#x51FD;&#x6570;</h3>
<p><a href="#sirenwu">&#x89C1;&#x56DB;&#x4EFB;&#x52A1;</a>  &#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x4EFB;&#x52A1;</p>
<p>&#x5411;&#x865A;&#x62DF;&#x673A;&#x6CE8;&#x518C; jni&#x51FD;&#x6570;(&#x540E;&#x9762;&#x8BA9;java&#x4FA7;&#x8C03;&#x7528;)</p>
<p>&#x4E09;&#x89D2;&#x5EA6;&#xFF1A;</p>
<blockquote>
<p>&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#xFF1A;<del>zygote native&#x8FDB;&#x7A0B;</del> &#x3002;&#x81EA;&#x7136;&#xFF0C;&#x56E0;&#x4E3A;&#x8981;&#x642D;&#x5EFA; &#x5899;&#x4E0A;&#x7684;&#x68AF;&#x5B50;</p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF1A;   /system/lib64/libandroid_runtime.so</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#xFF1A;frameworks/base/core/jni/AndroidRuntime.cpp</p>
<p>&#x4E09;w&#xFF1A;
when&#xFF1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x8D77;&#x6765;&#x4E4B;&#x540E;&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5899;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x600E;&#x4E48;&#x642D;&#x5EFA;&#x5899;&#x4E0A;&#x7684;&#x68AF;&#x5B50;&#xFF1F;</p>
<p>what&#xFF1A;</p>
<p>how&#xFF1A;&#x4E0D;&#x77E5;&#x9053;&#x5E95;&#x5C42;&#x673A;&#x5236;</p>
</blockquote>
<pre class="language-"><code class="lang-cpp"><span class="token keyword">int</span> <span class="token class-name">AndroidRuntime</span><span class="token double-colon punctuation">::</span><span class="token function">startReg</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/*
     * This hook causes all future threads created in this process to be
     * attached to the JavaVM.  (This needs to go away in favor of JNI
     * Attach calls.)
     */</span>
    <span class="token function">androidSetCreateThreadFunc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>android_create_thread_fn<span class="token punctuation">)</span> javaCreateThreadEtc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">register_jni_procs</span><span class="token punctuation">(</span>gRegJNI<span class="token punctuation">,</span> <span class="token function">NELEM</span><span class="token punctuation">(</span>gRegJNI<span class="token punctuation">)</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        env<span class="token operator">-&gt;</span><span class="token function">PopLocalFrame</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    env<span class="token operator">-&gt;</span><span class="token function">PopLocalFrame</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// gRegJNI&#x5C01;&#x88C5;&#x4E86;&#x5404;&#x79CD;&#x6CE8;&#x518C;&#x51FD;&#x6570;,&#x8FD1;&#x4E24;&#x767E;&#x4E2A;&#x6210;&#x5458;&#x51FD;&#x6570;</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> RegJNIRec gRegJNI<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_com_android_internal_os_RuntimeInit<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// &#x5C55;&#x5F00;&#x89C1;&#x4E0B;</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_com_android_internal_os_ZygoteInit_nativeZygoteInit<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_os_SystemClock<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_EventLog<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_Log<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_MemoryIntArray<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_PathParser<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_StatsLog<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_util_StatsLogInternal<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_app_admin_SecurityLog<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_content_AssetManager<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_content_StringBlock<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_content_XmlBlock<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_content_res_ApkAssets<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_text_AndroidCharacter<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_text_Hyphenator<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_view_InputDevice<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_os_Binder<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// </span>
    <span class="token function">REG_JNI</span><span class="token punctuation">(</span>register_android_os_Parcel<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
<p><strong>&#x672C;&#x8D28;&#x4E0A;&#xFF0C;Oracle&#x63D0;&#x4F9B;&#x7684;&#x6CE8;&#x518C;API&#x662F;</strong>&#xFF1A;<font color="red">&#x8BB0;&#x5FC6;</font>&#xFF1A; jniRegisterNativeMethods(env,  java&#x7684;<strong>&#x7C7B;&#x540D;</strong>&#xFF0C;<strong>&#x6620;&#x5C04;&#x5173;&#x7CFB;</strong> &#x6570;&#x7EC4;)</p>
<pre class="language-"><code class="lang-cpp"><span class="token keyword">int</span> <span class="token function">register_com_android_internal_os_RuntimeInit</span><span class="token punctuation">(</span>JNIEnv<span class="token operator">*</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">const</span> JNINativeMethod methods<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">//&#x3010;1&#x3011; &#x81EA;&#x7136;&#xFF0C;&#x6620;&#x5C04;&#x5173;&#x7CFB;&#x4E3A;&#xFF1A;java&#x51FD;&#x6570;&#x540D;string + java&#x51FD;&#x6570;&#x53C2;&#x6570;&#x7B7E;&#x540D; ------&#x300B;  native&#x51FD;&#x6570;&#x540D;</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;nativeFinishInit&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;()V&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> com_android_internal_os_RuntimeInit_nativeFinishInit <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token string">&quot;nativeSetExitWithoutCleanup&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(Z)V&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> com_android_internal_os_RuntimeInit_nativeSetExitWithoutCleanup <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">jniRegisterNativeMethods</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token string">&quot;com/android/internal/os/RuntimeInit&quot;</span><span class="token punctuation">,</span>
        methods<span class="token punctuation">,</span> <span class="token function">NELEM</span><span class="token punctuation">(</span>methods<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x90A3;&#x4E48;&#xFF0C;jniRegisterNativeMethods &#x673A;&#x5236;&#x539F;&#x7406;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;TODO: </p>
<h2 id="zygoteinitjava--main-&#x4E16;&#x754C;"><a name="zygoteinitjava--main-&#x4E16;&#x754C;" class="anchor-navigation-ex-anchor" href="#zygoteinitjava--main-&#x4E16;&#x754C;"><i class="fa fa-link" aria-hidden="true"></i></a>2.11. ZygoteInit.java  main &#x4E16;&#x754C;</h2>
<p><a href="#sirenwu">&#x89C1;&#x56DB;&#x4EFB;&#x52A1;</a>  &#xFF0C;&#x7B2C;&#x56DB;&#x4E2A;&#x4EFB;&#x52A1;</p>
<p>&#x4E09;&#x89D2;&#x5EA6;&#xFF1A;</p>
<blockquote>
<p>&#x8FDB;&#x7A0B;&#x89D2;&#x5EA6;&#xFF1A;<del>zygote main&#x8FDB;&#x7A0B;</del> &#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5DF2;&#x7ECF;&#x7FFB;&#x8FC7;&#x5899;&#xFF0C;&#x8FDB;&#x5165;java&#x4E16;&#x754C;</p>
<p>&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF1A;   framework.jar(&#x89C1;/frameworks/base/Android.bp )</p>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#xFF1A;/frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</p>
<p>&#x4E09;w&#xFF1A;
when&#xFF1A;&#x5728;&#x865A;&#x62DF;&#x673A;&#x8D77;&#x6765;&#x4E4B;&#x540E;&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5899;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x600E;&#x4E48;&#x642D;&#x5EFA;&#x5899;&#x4E0A;&#x7684;&#x68AF;&#x5B50;&#xFF1F;</p>
<p>what&#xFF1A;</p>
<p>how&#xFF1A;jni&#x8C03;&#x7684;</p>
</blockquote>
<pre class="language-"><code class="lang-cpp">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// &#x3010;&#x3011;&#x53C2;&#x6570;argv&#xFF0C;&#x4ECE;&#x4FE1;&#x606F;&#x6D41;&#x89D2;&#x5EA6;: rc&#x6587;&#x4EF6;&#x91CC;&#x7684;&#x53C2;&#x6570; &#xFF0C;&#x4F20;&#x7ED9; native&#xFF08;TODO:native&#x7528;&#x6765;&#x6807;&#x5FD7;&#x542F;&#x52A8;java zygote,d&#xFF09;&#xFF0C;&#x4E4B;&#x540E;native&#x53C8;&#x4F20;&#x7ED9;java&#x4FA7;&#xFF08;&#x7528;&#x6765;&#x6807;&#x5FD7;&#x542F;&#x52A8;system-server&#xFF09;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            boolean startSystemServer <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            String zygoteSocketName <span class="token operator">=</span> <span class="token string">&quot;zygote&quot;</span><span class="token punctuation">;</span>
            String abiList <span class="token operator">=</span> null<span class="token punctuation">;</span>
            boolean enableLazyPreload <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argv<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;start-system-server&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    startSystemServer <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//&#x6807;&#x5FD7;&#x540E;&#x9762;&#x542F;&#x52A8;system-server</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;--enable-lazy-preload&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    enableLazyPreload <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ABI_LIST_ARG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    abiList <span class="token operator">=</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>ABI_LIST_ARG<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>SOCKET_NAME_ARG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    zygoteSocketName <span class="token operator">=</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>SOCKET_NAME_ARG<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">final</span> boolean isPrimaryZygote <span class="token operator">=</span> zygoteSocketName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>Zygote<span class="token punctuation">.</span>PRIMARY_SOCKET_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableLazyPreload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">preload</span><span class="token punctuation">(</span>bootTimingsTraceLog<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//&#x3010;1&#x3011; &#x52A0;&#x8F7D;&#x5404;&#x79CD;&#x8D44;&#x6E90;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                Zygote<span class="token punctuation">.</span><span class="token function">resetNicePriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Do an initial gc to clean up after startup</span>
            <span class="token function">gcAndFinalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Zygote<span class="token punctuation">.</span><span class="token function">initNativeState</span><span class="token punctuation">(</span>isPrimaryZygote<span class="token punctuation">)</span><span class="token punctuation">;</span>

            zygoteServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ZygoteServer</span><span class="token punctuation">(</span>isPrimaryZygote<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>startSystemServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Runnable r <span class="token operator">=</span> <span class="token function">forkSystemServer</span><span class="token punctuation">(</span>abiList<span class="token punctuation">,</span> zygoteSocketName<span class="token punctuation">,</span> zygoteServer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#x3010;2&#x3011;fork SystemServer&#x8FDB;&#x7A0B;&#xFF0C;&#x89C1;&#x300A;forkSystemServer&#x300B;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    r<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// The select loop returns early in the child process after a fork and</span>
            <span class="token comment">// loops forever in the zygote.</span>
            caller <span class="token operator">=</span> zygoteServer<span class="token punctuation">.</span><span class="token function">runSelectLoop</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Throwable ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span> 

        <span class="token comment">// We&apos;re in the child process and have exited the select loop. Proceed to execute the</span>
        <span class="token comment">// command.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>caller <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            caller<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload"><a name="&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload" class="anchor-navigation-ex-anchor" href="#&#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload"><i class="fa fa-link" aria-hidden="true"></i></a>2.11.1. &#x52A0;&#x8F7D;&#x8D44;&#x6E90;preload()</h3>
<pre class="language-"><code class="lang-cpp"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">preload</span><span class="token punctuation">(</span>TimingsTraceLog bootTimingsTraceLog<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">preloadClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x3010;1&#x3011;&#x9884;&#x52A0;&#x8F7D;&#x7C7B;&#x8D44;&#x6E90;&#x5230;jvm&#x91CC;&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;view&#x3001;actvity&#x3001;Service&#x7B49;7600&#x4E2A;&#x7C7B;  &#x5B58;&#x4E8E;&#x6587;&#x4EF6;&quot;/system/etc/preloaded-classes&quot;</span>
        <span class="token function">preloadResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&#x3010;2&#x3011;&#x9884;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF0C;&#x5305;&#x542B;drawable&#x548C;color&#x8D44;&#x6E90;</span>
        <span class="token function">nativePreloadAppProcessHALs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">maybePreloadGraphicsDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//&#x3010;3&#x3011;&#x9884;&#x52A0;&#x8F7D;&quot;android&quot;,&quot;compiler_rt&quot;,&quot;jnigraphics&quot;&#x8FD9;3&#x4E2A;&#x5171;&#x4EAB;&#x5E93;&#xFF08;&#x901A;&#x8FC7;System.loadLibrary()&#x65B9;&#x6CD5;&#xFF09;</span>
        <span class="token function">preloadSharedLibraries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">preloadTextResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        WebViewFactory<span class="token punctuation">.</span><span class="token function">prepareWebViewInZygote</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>&#x3010;1&#x3011; &#x7C7B;&#x52A0;&#x8F7D;&#xFF0C;&#x6700;&#x7EC8;&#x91C7;&#x7528;&#x53CD;&#x5C04;&#x673A;&#x5236; java&#x7684;Class.forName()&#x65B9;&#x6CD5;&#x6765;&#x52A0;&#x8F7D;&#x3002;&#x81EA;&#x7136;&#xFF0C;&#x5FC5;&#x7136;&#x662F;&#x53CD;&#x5C04;&#xFF0C;&#x56E0;&#x4E3A;&#x7ED9;&#x5B9A;&#x7684;&#x662F;&#x5B57;&#x7B26;&#x4E32;</p>
<p>&#x7C7B;&#x9884;&#x52A0;&#x8F7D;&#x7684;&#x539F;&#x56E0;&#xFF1A;&#x6240;&#x6709;APP&#x8FDB;&#x7A0B;&#x5171;&#x7528;&#x4E00;&#x4EFD;<strong>&#x7C7B;&#x8D44;&#x6E90;</strong>&#xFF08;<strong>&#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x662F;&#x5BF9;&#x8C61;&#xFF0C;&#x8FD8;&#x6CA1;&#x5B9E;&#x4F8B;&#x5316;&#xFF01;</strong>&#xFF09;</p>
<p><strong><font color="red">&#x7406;&#x89E3;&#xFF0C;&#x672C;&#x8D28;</font>&#xFF1A;</strong>&#x7C7B;&#x3001;&#x666E;&#x901A;&#x7684;&#x56FE;&#x7247;jpg&#x8D44;&#x6E90;&#x3001;xml &#x672C;&#x8D28;&#x5E76;&#x65E0;&#x5DEE;&#x522B;**  ---&gt;  &#x90FD;&#x662F;&#x6CA1;&#x6709;&#x5B9E;&#x4F8B;&#x5316;&#x7684;&#x8D44;&#x6E90;</p>
<p><strong>&#x53BB;&#x91CD;&#x601D;&#x60F3;</strong>: &#x63D0;&#x53D6;&#x91CD;&#x590D;&#x7684;&#x3002;&#x653E;&#x5230; Zygote &#x8FDB;&#x7A0B;&#x91CC; ------&#x300B; &#x6CE8;&#x610F;&#xFF1A;&#x6B64;&#x65F6;&#x7684;jvm&#x5C5E;&#x4E8E; Zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x8D44;&#x6E90;&#x4E5F;&#x5728; Zygote&#x8FDB;&#x7A0B;&#x3002;</p>
<p>zygote&#x8FDB;&#x7A0B;&#x5185;&#x52A0;&#x8F7D;&#x4E86;preload()&#x65B9;&#x6CD5;&#x4E2D;&#x7684;&#x6240;&#x6709;&#x8D44;&#x6E90;&#xFF0C;&#x5F53;&#x9700;&#x8981;fork&#x65B0;&#x8FDB;&#x7A0B;&#x65F6;&#xFF0C;&#x91C7;&#x7528;copy on write&#x6280;&#x672F;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="InitSystem.assets/image-20221207212739899.png" alt="image-20221207212739899"></p>
<p>&#x53C2;&#x8003;&#xFF1A; <a href="https://github.com/huanzhiyazi/articles/issues/25" target="_blank">https://github.com/huanzhiyazi/articles/issues/25</a></p>
<p>&#x200B;            <a href="https://blog.51cto.com/u_15375308/5216330" target="_blank">https://blog.51cto.com/u_15375308/5216330</a>    &#x6DF1;&#x5165;&#x7406;&#x89E3; Android &#x5185;&#x6838;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#xFF08;&#x4E8C;&#xFF09;&#x5185;&#x5B58;&#x7BA1;&#x7406;</p>
<p><code>copy on write</code> &#x539F;&#x5219;&#xFF1A;&#x6240;&#x6709;&#x7684;&#x5B50;&#x8FDB;&#x7A0B;&#x4E0E;&#x7236;&#x8FDB;&#x7A0B;&#x9ED8;&#x8BA4;&#x90FD;&#x5171;&#x4EAB;&#x6240;&#x6709;&#x8D44;&#x6E90;&#xFF0C;&#x7236;&#x8FDB;&#x7A0B; fork &#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x4E4B;&#x540E;&#xFF0C;&#x5B50;&#x8FDB;&#x7A0B;<font color="red">&#x53EA;&#x9700;&#x8981;</font>&#x751F;&#x6210;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;<font color="red">&#x5F15;&#x7528;</font>&#x5373;&#x53EF;&#x3002;&#x53EA;&#x6709;&#x5F53;&#x5B50;&#x8FDB;&#x7A0B;&#x9700;&#x8981;&#x5BF9;&#x67D0;&#x4E2A;&#x8D44;&#x6E90;&#x8FDB;&#x884C;<strong>&#x5199;&#x5165;&#x65F6;</strong>&#xFF0C;<strong>&#x624D;&#x9700;&#x8981;&#x62F7;&#x8D1D;&#x4E00;&#x4EFD;&#x539F;&#x8D44;&#x6E90;</strong>&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x8D44;&#x6E90;&#x7684;&#x72EC;&#x7ACB;&#x6027;&#x3002;</p>
<p>----&gt;  <code>&#x81EA;&#x7136;&#xFF0C;&#x597D;&#x5904;&#x662F;</code>&#xFF1A;
&#x5B89;&#x5168;&#x6027;&#x4E0A;&#xFF1A;&#x4FDD;&#x8BC1;&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x8BBF;&#x95EE;&#x5B89;&#x5168;&#xFF08;&#x6BCF;&#x4E2A;java&#x8FDB;&#x7A0B;&#x90FD;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#x4E5F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#xFF09;
1&#x3001;&#x65F6;&#x95F4;&#x4E0A;&#xFF1A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x52A0;&#x8F7D;&#x8D44;&#x6E90;&#xFF08;&#x65E0;&#x9700;&#x6BCF;&#x4E2A;java&#x8FDB;&#x7A0B;&#x90FD;&#x53BB;&#x52A0;&#x8F7D;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#xFF0C;&#x52A0;&#x8F7D;&#x6D41;&#x7A0B;&#x5F88;&#x6D88;&#x8017;&#x65F6;&#x95F4;&#xFF09;
2&#x3001;&#x7A7A;&#x95F4;&#x4E0A;&#xFF1A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5185;&#x5B58;&#x6301;&#x6709;&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x63A8;&#x8BBA;&#xFF1A;TODO: &#x9A8C;&#x8BC1;</p>
<p>1&#x3001;VM&#x5B9E;&#x4F8B;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x53C2;&#x6570;&#x4E0D;&#x4E00;&#x6837;&#xFF0C;&#x6240;&#x4EE5;&#x6D89;&#x53CA;&#x4FEE;&#x6539;&#xFF0C;&#x4F1A;copy&#x4E00;&#x4E2A;VM&#x5B9E;&#x4F8B;</p>
<p>2&#x3001;&#x5176;&#x4ED6;&#x8D44;&#x6E90;&#xFF0C;&#x5C24;&#x5176;&#x7C7B;&#x8D44;&#x6E90;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x5C31;&#x4E00;&#x4EFD;&#x3002;</p>
<p><img src="InitSystem.assets/c915be627ec6019265b4cfd33c583d30.jpeg" alt="img"></p>
<p>&#x6765;&#x81EA;&#xFF1A;<a href="https://blog.csdn.net/m0_37999066/article/details/127271879" target="_blank">https://blog.csdn.net/m0_37999066/article/details/127271879</a></p>
<p>TODO:  Class.forName() &#x52A0;&#x8F7D;&#x7C7B;&#x8D44;&#x6E90;&#x5230;jvm &#x539F;&#x7406;</p>
<p>&#x4ECE;&#x8D44;&#x6E90;&#x52A0;&#x8F7D;&#x7684;&#x89D2;&#x5EA6;&#xFF0C;<code>&#x7406;&#x89E3;&#x8BBE;&#x8BA1;zygote&#x7684;&#x5FC5;&#x8981;&#x6027;(&#x5408;&#x7406;&#x6027;)</code>&#xFF1A;&#x4E3B;&#x8981;&#x9700;&#x8981;&#x4E00;&#x4E2A;<font color="red">&#x5171;&#x4EAB;&#x8D44;&#x6E90;&#x7684;&#x7956;&#x5148;</font>  &#xFF08;&#x53BB;&#x91CD;&#x601D;&#x60F3;&#x7684;&#x63A8;&#x8BBA;&#xFF0C;&#x65F6;&#x95F4;&#x4E0A;&#x53BB;&#x91CD;&#x3001;&#x7A7A;&#x95F4;&#x4E0A;&#x53BB;&#x91CD;&#xFF09;</p>
<h3 id="forksystemserver"><a name="forksystemserver" class="anchor-navigation-ex-anchor" href="#forksystemserver"><i class="fa fa-link" aria-hidden="true"></i></a>2.11.2. forkSystemServer</h3>
<p>&#x975E;&#x5E38;&#x81EA;&#x7136;&#xFF0C;&#x52A0;&#x8F7D;&#x5B8C;&#x5171;&#x7528;&#x8D44;&#x6E90;&#xFF0C;&#x7136;&#x540E;&#x542F;&#x52A8; java&#x8FDB;&#x7A0B;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">// ZygoteInit.java</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">startSystemServer</span><span class="token punctuation">(</span><span class="token class-name">String</span> abiList<span class="token punctuation">,</span> <span class="token class-name">String</span> socketName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    pid <span class="token operator">=</span> <span class="token class-name">Zygote</span><span class="token punctuation">.</span><span class="token function">forkSystemServer</span><span class="token punctuation">(</span>     <span class="token comment">//&#x3010;1&#x3011; &#x900F;&#x4F20;</span>
            parsedArgs<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> parsedArgs<span class="token punctuation">.</span>gid<span class="token punctuation">,</span>
            parsedArgs<span class="token punctuation">.</span>gids<span class="token punctuation">,</span>
            parsedArgs<span class="token punctuation">.</span>debugFlags<span class="token punctuation">,</span>
            <span class="token keyword">null</span><span class="token punctuation">,</span>
            parsedArgs<span class="token punctuation">.</span>permittedCapabilities<span class="token punctuation">,</span>
            parsedArgs<span class="token punctuation">.</span>effectiveCapabilities<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasSecondZygote</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">waitForSecondaryZygote</span><span class="token punctuation">(</span>socketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">handleSystemServerProcess</span><span class="token punctuation">(</span>parsedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//&#x8FDB;&#x5165;system_server&#x8FDB;&#x7A0B;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>&#x3010;1&#x3011; &#x5904;&#xFF0C;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">//Zygote.java</span>
<span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">nativeForkSystemServer</span><span class="token punctuation">(</span>  <span class="token comment">// &#x8D70;native</span>
    uid<span class="token punctuation">,</span> gid<span class="token punctuation">,</span> gids<span class="token punctuation">,</span> runtimeFlags<span class="token punctuation">,</span> rlimits<span class="token punctuation">,</span>
    permittedCapabilities<span class="token punctuation">,</span> effectiveCapabilities<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x6240;&#x4EE5;&#xFF0C;&#x66F4;&#x672C;&#x8D28;&#x7684;&#xFF0C;&#x8FD8;&#x662F;native&#x53BB;fork&#x7684;</p>
<p>TODO:  </p>
<p>native&#x4FA7;&#xFF1A;</p>
<pre class="language-"><code class="lang-cpp">pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//&#x6700;&#x7EC8;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span>
</code></pre>
<h3 id="zygoteinitrunselectloop"><a name="zygoteinitrunselectloop" class="anchor-navigation-ex-anchor" href="#zygoteinitrunselectloop"><i class="fa fa-link" aria-hidden="true"></i></a>2.11.3. ZygoteInit.runSelectLoop</h3>
<p>&#x81EA;&#x7136;&#xFF0C;&#x521B;&#x5EFA;&#x5B8C;systemServer&#x4E4B;&#x540E;&#xFF0C;Zygote&#x7EBF;&#x7A0B;&#x8FDB;&#x5165;Looper&#x3002;&#x968F;&#x65F6;&#x5F85;&#x547D;&#xFF0C;&#x5F53;&#x63A5;&#x6536;&#x5230;&#x8BF7;&#x6C42;&#x521B;&#x5EFA;&#x65B0;&#x8FDB;&#x7A0B;&#x8BF7;&#x6C42;&#x65F6;<strong>&#x7ACB;&#x5373;&#x5524;&#x9192;</strong>&#x5E76;&#x6267;&#x884C;&#x76F8;&#x5E94;&#x5DE5;&#x4F5C;&#x3002;</p>
<p>TODO:  Zygote&#x91C7;&#x7528;&#x9AD8;&#x6548;&#x7684;I/O&#x591A;&#x8DEF;&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x4FDD;&#x8BC1;&#x5728;&#x6CA1;&#x6709;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x6216;&#x6570;&#x636E;&#x5904;&#x7406;&#x65F6;&#x4F11;&#x7720;&#xFF0C;&#x5426;&#x5219;&#x54CD;&#x5E94;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<pre class="language-"><code class="lang-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">runSelectLoop</span><span class="token punctuation">(</span><span class="token class-name">String</span> abiList<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MethodAndArgsCaller</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileDescriptor</span><span class="token punctuation">&gt;</span></span> fds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FileDescriptor</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ZygoteConnection</span><span class="token punctuation">&gt;</span></span> peers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ZygoteConnection</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//sServerSocket&#x662F;socket&#x901A;&#x4FE1;&#x4E2D;&#x7684;&#x670D;&#x52A1;&#x7AEF;&#xFF0C;&#x5373;zygote&#x8FDB;&#x7A0B;</span>
    fds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sServerSocket<span class="token punctuation">.</span><span class="token function">getFileDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    peers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StructPollfd</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pollFds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StructPollfd</span><span class="token punctuation">[</span>fds<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pollFds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StructPollfd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>fd <span class="token operator">=</span> fds<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span><span class="token punctuation">)</span> <span class="token constant">POLLIN</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">Os</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span>pollFds<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x3010;1&#x3011;&#x8FD9;&#x4E2A;&#x673A;&#x5236;&#x7C7B;&#x4F3C;&#x4E8E; Looper.loop()&#x4E2D;&#x7684;epoll</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> pollFds<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//&#x91C7;&#x7528;I/O&#x591A;&#x8DEF;&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x5F53;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x51FA; &#x8FDE;&#x63A5;&#x8BF7;&#x6C42;&#x6216;&#x8005;&#x6570;&#x636E;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5219;&#x6267;&#x884C;continue</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pollFds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>revents <span class="token operator">&amp;</span> <span class="token constant">POLLIN</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//&#x521B;&#x5EFA;&#x5BA2;&#x6237;&#x7AEF;&#x8FDE;&#x63A5;</span>
                <span class="token class-name">ZygoteConnection</span> newPeer <span class="token operator">=</span> <span class="token function">acceptCommandPeer</span><span class="token punctuation">(</span>abiList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                peers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newPeer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                fds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>newPeer<span class="token punctuation">.</span><span class="token function">getFileDesciptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//&#x5904;&#x7406;&#x5BA2;&#x6237;&#x7AEF;&#x6570;&#x636E;&#x4E8B;&#x52A1;</span>
                <span class="token keyword">boolean</span> done <span class="token operator">=</span> peers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    peers<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fds<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

&#x53C2;&#x8003;<span class="token operator">:</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>gityuan<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token number">2016</span><span class="token operator">/</span><span class="token number">02</span><span class="token operator">/</span><span class="token number">01</span><span class="token operator">/</span>android<span class="token operator">-</span>booting<span class="token operator">/</span>
</code></pre>
<p>&#x3010;1&#x3011; TODO:   <a href="https://www.cnblogs.com/laosiji888/articles/5524067.html" target="_blank">https://www.cnblogs.com/laosiji888/articles/5524067.html</a></p>
<p><a href="http://gityuan.com/2019/01/06/linux-epoll/" target="_blank">http://gityuan.com/2019/01/06/linux-epoll/</a>   &#x6E90;&#x7801;&#x89E3;&#x8BFB;epoll&#x5185;&#x6838;&#x673A;&#x5236;</p>
<p><a href="http://gityuan.com/2019/01/05/linux-poll-select/" target="_blank">http://gityuan.com/2019/01/05/linux-poll-select/</a>  &#x6E90;&#x7801;&#x89E3;&#x8BFB;poll/select&#x5185;&#x6838;&#x673A;&#x5236;</p>
<p>&#x672C;&#x8D28;&#xFF1A;socket&#x670D;&#x52A1;&#x7AEF;&#x3002;  TODO: &#x603B;&#x7ED3;&#x5B89;&#x5353;&#x901A;&#x4FE1;socket</p>
<h2 id="systemserver&#x8FDB;&#x7A0B;&#x542F;&#x52A8;"><a name="systemserver&#x8FDB;&#x7A0B;&#x542F;&#x52A8;" class="anchor-navigation-ex-anchor" href="#systemserver&#x8FDB;&#x7A0B;&#x542F;&#x52A8;"><i class="fa fa-link" aria-hidden="true"></i></a>2.12. SystemServer&#x8FDB;&#x7A0B;&#x542F;&#x52A8;</h2>
<p>&#x53C2;&#x8003;&#xFF1A; <a href="http://gityuan.com/2016/02/14/android-system-server/" target="_blank">http://gityuan.com/2016/02/14/android-system-server/</a>
            <a href="https://www.jianshu.com/p/9912a556734f" target="_blank">https://www.jianshu.com/p/9912a556734f</a>     Android&#x5F00;&#x673A;&#x6D41;&#x7A0B;&#x542F;&#x52A8;&#x7684;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#x4EE5;&#x53CA;&#x529F;&#x80FD;&#x4ECB;&#x7ECD;&#x5217;&#x8868;</p>
<p>&#x95EE;&#x9898;&#xFF1A;SystemServer&#x5982;&#x4F55;&#x88AB;&#x521B;&#x5EFA;&#xFF0C;&#x5982;&#x4F55;&#x6267;&#x884C;&#x7684;main&#xFF1F;&#x4E3B;&#x8981;&#x505A;&#x4E86;&#x5565;&#xFF1F;</p>
<p>main&#x6D41;&#x7A0B;&#xFF0C;&#x603B;&#x5171;&#x542F;&#x52A8;90&#x591A;&#x4E2A;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#xFF1A;&#x81EA;&#x7136;&#xFF0C;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7BA1;&#x7406;&#x7C7B;mSystemServiceManager</p>
<pre class="language-"><code class="lang-java"><span class="token class-name">SystemServer</span><span class="token punctuation">.</span>java &#x623F;&#x95F4;&#x4E2D;

<span class="token comment">// Start services.</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//cg: https://www.jianshu.com/p/9912a556734f</span>
        <span class="token function">startBootstrapServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// cg: Bootstrap &#x542F;&#x52A8;&#x5F15;&#x5BFC;&#x670D;&#x52A1;: AMS, PMS, powerMS, Lights,</span>
        <span class="token function">startCoreServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// cg: CoreService: BatteryService, webview</span>
        <span class="token function">startOtherServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// cg: Other: InputMS, CameraService,</span>
</code></pre>
<pre class="language-"><code class="lang-java"><span class="token comment">// &#x5177;&#x4F53;&#x542F;&#x52A8;&#x6838;&#x5FC3;&#x4EE3;&#x7801;</span>
        <span class="token class-name">ActivityTaskManagerService</span> atm <span class="token operator">=</span> mSystemServiceManager<span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span> <span class="token comment">// cg: ATMS</span>
                <span class="token class-name">ActivityTaskManagerService<span class="token punctuation">.</span>Lifecycle</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mActivityManagerService <span class="token operator">=</span> <span class="token class-name">ActivityManagerService<span class="token punctuation">.</span>Lifecycle</span><span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span> <span class="token comment">// cg: AMS&#xFF08;&#x6CE8;&#x610F;AMS&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x6CE8;&#x518C;&#xFF0C;&#x5728;setSystemProcess&#x4E2D;&#x6CE8;&#x518C;&#x7684;&#xFF09;</span>
                mSystemServiceManager<span class="token punctuation">,</span> atm<span class="token punctuation">)</span><span class="token punctuation">;</span>

    mPowerManagerService <span class="token operator">=</span> mSystemServiceManager<span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span><span class="token class-name">PowerManagerService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cg&#xFF1A;PowerManagerService</span>


    mSystemServiceManager<span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span><span class="token string">&quot;com.google.android.clockwork.sidekick.SidekickService&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cg&#xFF1A;&#x76F4;&#x63A5;&#x901A;&#x8FC7; &#x7C7B;&#x540D; &#x53CD;&#x5C04;</span>
</code></pre>
<p>AMS&#x548C;ATMS&#x901A;&#x8FC7;&#x5185;&#x90E8;&#x7C7B; Lifecycle&#xFF08;SystemService&#xFF09; &#x4F20;&#x53C2;&#x7ED9; SystemServiceManager</p>
<p>PMS &#x4F20;&#x7684;&#x662F;&#x672C;&#x8EAB; PowerManagerService&#xFF08;SystemService&#xFF09;</p>
<p>----&gt;  &#x672C;&#x8D28;&#x4E0A;&#xFF0C;
1&#x3001;&#x4E24;&#x8005;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;<font color="red">&#x56E0;&#x4E3A; Lifecycle&#x662F;&#x5185;&#x90E8;&#x7C7B;&#xFF0C;&#x5373;&#x7B49;&#x540C;&#x4E8E;&#x5916;&#x90E8;&#x7C7B;&#x3002;</font>
        Lifecycle&#x62BD;&#x51FA;&#x4E86; &#x751F;&#x547D;&#x5468;&#x671F;&#x76F8;&#x5173;&#x7684;&#x65B9;&#x6CD5;&#xFF08;onStart&#xFF09;&#xFF0C;&#x611F;&#x89C9;&#x66F4;&#x96C6;&#x4E2D;</p>
<p>2&#x3001;&#x65E2;&#x7136;&#x4E00;&#x6837;&#xFF0C;&#x4E3A;&#x5565;&#x8981;&#x6709;&#x4E0D;&#x540C;&#x5199;&#x6CD5;&#xFF1F;
 -<font color="red">&#x4E0D;&#x5F97;&#x4E0D;&#xFF1A;</font>  AMS &#x6D89;&#x53CA;&#x5230; &#x4E0E;APP&#x901A;&#x4FE1;&#xFF0C;&#x6240;&#x4EE5;&#x8981;&#x7EE7;&#x627F; stub&#x3002;&#x4E5F;&#x8981;&#x7EE7;&#x627F; SystemService &#x3002; 
----&gt;     &#x6D89;&#x53CA;&#x5230;&#x591A;&#x7EE7;&#x627F;&#xFF0C;&#x6240;&#x4EE5;&#xFF0C;&#x53EA;&#x80FD;&#x53D6;&#x4E00;&#x4E2A;&#x3002;
EX1&#xFF1A;AMS  extends stub&#xFF0C; &#x5185;&#x90E8;&#x7C7B;Lifecycle extends SystemService, 
EX2&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53CD;&#x8FC7;&#x6765;&#xFF1A;PowerManagerService extends SystemService&#xFF0C;&#x5176;&#x5185;&#x90E8;&#x7C7B;&#x7EE7;&#x627F; stub</p>
<p>Q:  &#x8BBE;&#x8BA1;&#x4E0A;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x6709;SystemService&#xFF1F;  </p>
<p>A:  &#x76EE;&#x7684;&#xFF1A;&#x8BA9;&#x6240;&#x6709;&#x88AB;&#x7BA1;&#x7406;&#x8005;&#x7EE7;&#x627F;&#xFF0C;&#x4F20;&#x7ED9;manager&#xFF0C;&#x7EDF;&#x4E00;&#x7BA1;&#x7406;
  --------&#x300B; &#x6216;&#x8005;&#x8BF4;&#xFF1A;SystemService &#x662F;&#x88AB;&#x7BA1;&#x7406;&#x63A5;&#x53E3; &#xFF0C;&#x662F;&#x6240;&#x6709;&#x88AB;&#x7BA1;&#x7406;&#x8005; &#x88AB;&#x7BA1;&#x7406;&#x90E8;&#x5206;&#x7684;&#x62BD;&#x8C61;</p>
<h3 id="&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;msystemservicemanagerstartservice"><a name="&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;msystemservicemanagerstartservice" class="anchor-navigation-ex-anchor" href="#&#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;msystemservicemanagerstartservice"><i class="fa fa-link" aria-hidden="true"></i></a>2.12.1. &#x5411;&#x4E0B;&#x5206;&#x6790;&#x6838;&#x5FC3;&#x4EE3;&#x7801;mSystemServiceManager.startService</h3>
<p>&#x6838;&#x5FC3;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">// SystemServiceManager.java</span>

  <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> constructor <span class="token operator">=</span> serviceClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//cg: reflect, serviceClass &#x7528;&#x53CD;&#x5C04;&#x6765;&#x7EDF;&#x4E00;new  AMS&#x3001;PMS&#x7B49;</span>
                service <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register it. ----&gt;&#x81EA;&#x7136;&#xFF0C;&#x7BA1;&#x7406;&#xFF0C;&#x81EA;&#x7136;&#x8981;&#x5411;SystemServiceManager&#x6CE8;&#x518C;&#xFF0C;java&#x4FA7;&#xFF1F;&#xFF1F;&#xFF1F;&#xFF1F;</span>
mServices<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>&#x4E3A;&#x5565;&#x4E00;&#x5B9A;&#x8981;&#x7528;&#x53CD;&#x5C04;&#x5462;&#xFF1F;   TODO</p>
<p>&#x53EF;&#x80FD;&#x539F;&#x56E0;&#xFF1A;</p>
<blockquote>
<p>1&#x3001;&#x6709;90&#x4E2A;&#x670D;&#x52A1;&#xFF0C;&#x4F9D;&#x8D56;&#x592A;&#x591A;&#xFF0C;<font color="red">&#x89C4;&#x907F;&#x4F9D;&#x8D56;&#x90A3;&#x4E48;&#x591A;&#x670D;&#x52A1;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x7EDF;&#x4E00;&#x7528;&#x53CD;&#x5C04;</font>&#xFF1F;</p>
<p>2&#x3001;<font color="red">&#x4EE3;&#x7801;&#x7ED3;&#x6784;&#x4E0A;&#x66F4;&#x7B80;&#x6D01; </font>  --------------   &#x7EDF;&#x4E00;&#xFF0C;&#x7C7B;&#x4F3C;&#x4E8E;&#x5404;&#x79CD;&#x63A7;&#x4EF6;&#x7684;&#x53CD;&#x5C04;&#x521B;&#x5EFA;&#xFF1A;  &#x5426;&#x5219;&#x5F97;&#x5404;&#x79CD;new A1()&#xFF1B; new A2()</p>
</blockquote>
<p>&#x7591;&#x95EE;&#xFF1A;</p>
<blockquote>
<p>AMS&#x3001;ATMS&#x542F;&#x52A8;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x542F;&#x52A8;&#x7EBF;&#x7A0B;&#x662F;&#x5728;&#x54EA;&#x91CC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x6765;&#x7684;&#xFF1F;-----------&gt; &#x89C1;&#x300A;binder&#x7EBF;&#x7A0B;&#x6C60;&#x300B;</p>
</blockquote>
<h3 id="publishbinderservice-&#x5411;native&#x6CE8;&#x518C;ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;"><a name="publishbinderservice-&#x5411;native&#x6CE8;&#x518C;ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;" class="anchor-navigation-ex-anchor" href="#publishbinderservice-&#x5411;native&#x6CE8;&#x518C;ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>2.12.2. publishBinderService &#x5411;Native&#x6CE8;&#x518C;Ibinder&#xFF08;&#x6838;&#x5FC3;&#xFF09;</h3>
<p>&#x6CE8;&#x518C;&#xFF1A;</p>
<pre class="language-"><code class="lang-java"><span class="token comment">// ActivityTaskManagerService.java</span>
<span class="token function">publishBinderService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">ACTIVITY_TASK_SERVICE</span><span class="token punctuation">,</span> mService<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cg: used by APP process,saved to serviceManger</span>
<span class="token class-name">LocalServices</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token class-name">ActivityTaskManagerInternal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> mInternal<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//cg: used by systemServer</span>
</code></pre>
<p>-<font color="red">ATMS &#x5411;native&#x6CE8;&#x518C;, &#x5373;&#x662F;&#x5411; APP &#x516C;&#x5E03;&#x51FA;&#x53BB;publishBinderService</font></p>
<p><img src="InitSystem.assets/image-20230122131124550.png" alt="image-20230122131124550"></p>
<p>ServiceManager&#x7684;&#x672C;&#x8D28;&#xFF1A;
&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x5217;&#x8868;&#xFF0C;&#x5B58;&#x50A8;  &#x201C;&#x670D;&#x52A1;&#x540D;&#x201D;  &#x4E0E;  binder&#x9A71;&#x52A8;</p>
<p>&#x7591;&#x95EE;&#xFF1A;
&#x975E;Binder&#x5F62;&#x5F0F;&#x7684;service&#x4E0D;&#x7528;&#x6CE8;&#x518C;&#x4E86;&#xFF1F;</p>
<p>&#x7591;&#x95EE;&#xFF1A;
&#x4E0E;       registerService(Context.ACTIVITY_TASK_SERVICE, ActivityTaskManager.class,  &#x5DEE;&#x522B;&#xFF1F;
----&gt;   &#x540E;&#x8005;&#x662F;&#x5E94;&#x7528;&#x4FA7;&#x7684;&#xFF0C;&#x524D;&#x8005;&#x7CFB;&#x7EDF;&#x4FA7;</p>
<h3 id="ams-new&#x540E;&#xFF0C;&#x7531;ams&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;"><a name="ams-new&#x540E;&#xFF0C;&#x7531;ams&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#ams-new&#x540E;&#xFF0C;&#x7531;ams&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.12.3. AMS new&#x540E;&#xFF0C;&#x7531;AMS&#x6CE8;&#x518C;&#x4E00;&#x5806;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x670D;&#x52A1;</h3>
<pre class="language-"><code class="lang-java"><span class="token comment">// SystemServer.java</span>
mActivityManagerService<span class="token punctuation">.</span><span class="token function">setSystemProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//cg: register service</span>
</code></pre>
<p>AMS<font color="red">&#x7BA1;&#x7406;&#x5404;&#x4E2A;&#x5E94;&#x7528;</font>&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x7531;&#x5176;&#x6CE8;&#x518C;&#x7684;&#x76F8;&#x5173;&#x670D;&#x52A1;&#x6709;(<font color="red">&#x81EA;&#x7136;&#xFF0C;&#x4E0E;&#x8FDB;&#x7A0B;&#x76F8;&#x5173;&#x7684;&#x670D;&#x52A1;</font>)&#xFF1A;</p>
<pre class="language-"><code class="lang-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSystemProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">ACTIVITY_SERVICE</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token comment">/* allowIsolated= */</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token constant">DUMP_FLAG_PRIORITY_CRITICAL</span> <span class="token operator">|</span> <span class="token constant">DUMP_FLAG_PRIORITY_NORMAL</span> <span class="token operator">|</span> <span class="token constant">DUMP_FLAG_PROTO</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// cg: register AMS(this)&#xFF0C; AMS &#x672C;&#x8EAB;</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token class-name">ProcessStats</span><span class="token punctuation">.</span><span class="token constant">SERVICE_NAME</span><span class="token punctuation">,</span> mProcessStats<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cg: ProcessStats of APP, APP&#x8FDB;&#x7A0B;&#x4FE1;&#x606F;</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;meminfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MemBinder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">/* allowIsolated= */</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    <span class="token constant">DUMP_FLAG_PRIORITY_HIGH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// cg: register meminfo(of App) service</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;gfxinfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">GraphicsBinder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;dbinfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DbBinder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MONITOR_CPU_USAGE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;cpuinfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CpuBinder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token comment">/* allowIsolated= */</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token constant">DUMP_FLAG_PRIORITY_CRITICAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;permission&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PermissionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cg: register permission&#x6743;&#x9650;</span>
            <span class="token class-name">ServiceManager</span><span class="token punctuation">.</span><span class="token function">addService</span><span class="token punctuation">(</span><span class="token string">&quot;processinfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ProcessInfoService</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cg: register ProcessInfo(of APP) service</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ProcessRecord</span> app <span class="token operator">=</span> mProcessList<span class="token punctuation">.</span><span class="token function">newProcessRecordLocked</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> info<span class="token punctuation">.</span>processName<span class="token punctuation">,</span>
                        <span class="token boolean">false</span><span class="token punctuation">,</span>
                        <span class="token number">0</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">HostingRecord</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                mProcessList<span class="token punctuation">.</span><span class="token function">updateLruProcessLocked</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// cg:  add ProcessRecord</span>
                <span class="token function">updateOomAdjLocked</span><span class="token punctuation">(</span><span class="token class-name">OomAdjuster</span><span class="token punctuation">.</span><span class="token constant">OOM_ADJ_REASON_NONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre>
<h2 id="------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------"><a name="------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------" class="anchor-navigation-ex-anchor" href="#------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------"><i class="fa fa-link" aria-hidden="true"></i></a>2.13. -------&#x6D41;&#x7A0B;end&#xFF0C;&#x57FA;&#x4E8E;0&#x5C42;------</h2>
<h2 id="&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;"><a name="&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.14. &#x57FA;&#x4E8E;0&#x5C42;&#xFF0C;&#x8865;&#x5145;&#x6B21;&#x8981;linux&#x8FDB;&#x7A0B;&#xFF1A;</h2>
<p>&#x53C2;&#x8003;&#xFF1A;<a href="https://blog.csdn.net/yjzl1911/article/details/5613569" target="_blank">https://blog.csdn.net/yjzl1911/article/details/5613569</a></p>
<p><img src="InitSystem.assets/image-20221201004713681.png" alt="image-20221201004713681"></p>
<h2 id="&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;"><a name="&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;" class="anchor-navigation-ex-anchor" href="#&#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;"><i class="fa fa-link" aria-hidden="true"></i></a>2.15. &#x51E0;&#x5927;&#x91CD;&#x8981;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;</h2>
<p><img src="InitSystem.assets/android-booting.jpg" alt="android-booting"></p>
<p>-------&gt;  Todo&#xFF1A;&#x91CD;&#x65B0;&#x753B;</p>
<p>servicemanager &#x7BA1;&#x7406;Binder&#x7684;</p>
<h2 id="&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;"><a name="&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>2.16. &#x53C2;&#x8003;&#x94FE;&#x63A5;&#xFF1A;</h2>
<p><a href="http://gityuan.com/android/" target="_blank">http://gityuan.com/android/</a>        </p>
<p><a href="https://blog.csdn.net/yangwen123/article/details/17258023" target="_blank">https://blog.csdn.net/yangwen123/article/details/17258023</a>  Zygote&#x8FDB;&#x7A0B;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x6E90;&#x4EE3;&#x7801;&#x5206;&#x6790;</p>
<p><a href="http://gityuan.com/2016/02/13/android-zygote/" target="_blank">http://gityuan.com/2016/02/13/android-zygote/</a></p>
<h2 id="&#x7591;&#x95EE;"><a name="&#x7591;&#x95EE;" class="anchor-navigation-ex-anchor" href="#&#x7591;&#x95EE;"><i class="fa fa-link" aria-hidden="true"></i></a>2.17. &#x7591;&#x95EE;</h2>
<p><a href="https://blog.csdn.net/yangwen123/article/details/17258023" target="_blank">https://blog.csdn.net/yangwen123/article/details/17258023</a></p>
<p><img src="InitSystem.assets/20130611110103500" alt="img"></p>
<p>&#x4E0A;&#x9762;serviceManager&#x753B;&#x6CD5;&#x662F;&#x5BF9;&#x7684;&#x3002;&#x7BA1;&#x7406;java&#x548C;native ----&gt; &#x672C;&#x8D28;&#x90FD;&#x662F;native&#x505A;&#x7684;</p>
<p><img src="InitSystem.assets/20130611105239578" alt="img"></p>
<p><img src="InitSystem.assets/20200507094738750.png" alt="&#x5728;&#x8FD9;&#x91CC;&#x63D2;&#x5165;&#x56FE;&#x7247;&#x63CF;&#x8FF0;"></p>
<p>&#x8FD9;&#x4E2A;&#x56FE;&#x753B;&#x5F97;&#x633A;&#x597D;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;&#xFF1F;  <a href="https://blog.csdn.net/wcsbhwy/article/details/105965932" target="_blank">https://blog.csdn.net/wcsbhwy/article/details/105965932</a>   Zygote&#x5982;&#x4F55;fork&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;</p>
<p>&#x7591;&#x95EE;&#xFF1A;&#x6240;&#x6709;&#x72EC;&#x7ACB;&#x8FDB;&#x7A0B;&#xFF0C;&#x90FD;&#x662F;&#x9760; &#x6B7B;&#x5FAA;&#x73AF;loop() + epoll&#x5524;&#x9192;&#x800C;&#x5B58;&#x6D3B;&#x3002;&#x89C1;&#x4E0A;&#x9762;&#x56FE;</p>
<p>-<font color="red">            &#x90A3;&#x4E48;&#x7EBF;&#x7A0B;&#x5462;&#xFF1F;&#x6BD4;&#x5982;WMS&#x4E0E;AMS&#xFF1F;</font></p>
<h2 id="&#x9762;&#x8BD5;&#x9898;"><a name="&#x9762;&#x8BD5;&#x9898;" class="anchor-navigation-ex-anchor" href="#&#x9762;&#x8BD5;&#x9898;"><i class="fa fa-link" aria-hidden="true"></i></a>2.18. &#x9762;&#x8BD5;&#x9898;:</h2>
<h3 id="&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;systemserver&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;zygote&#xFF1F;"><a name="&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;systemserver&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;zygote&#xFF1F;" class="anchor-navigation-ex-anchor" href="#&#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;systemserver&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;zygote&#xFF1F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.18.1. &#x5B75;&#x5316;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x8FD9;&#x79CD;&#x4E8B;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x4EA4;&#x7ED9;SystemServer&#x6765;&#x505A;&#xFF0C;&#x800C;&#x4E13;&#x95E8;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;Zygote&#xFF1F;</h3>
<p>&#x7B49;&#x4EF7;&#x95EE;&#x9898;&#xFF1A;</p>
<blockquote>
<p><strong>zygote&#x8BBE;&#x8BA1;&#x7684;&#x5FC5;&#x8981;&#x6027;</strong>&#x5728;&#x54EA;&#x91CC;&#xFF1F; </p>
</blockquote>
<p>------&gt;   &#x95EE;&#x9898;&#x7684;&#x672C;&#x8D28;&#xFF1A;Zygote&#x7684;&#x5B58;&#x5728;&#x5408;&#x7406;&#x6027;(0&#x5C42;&#x56FE;&#x9700;&#x8981;&#x8003;&#x8651;&#x7684;)</p>
<p>&#x6548;&#x7387;&#x89D2;&#x5EA6;&#xFF1A;
&#x5E94;&#x7528;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x505A;&#x5F88;&#x591A;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#xFF0C;<strong>&#x5305;&#x62EC;&#x542F;&#x52A8;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x52A0;&#x8F7D;&#x5404;&#x7C7B;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;</strong>&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x90FD;&#x662F;&#x975E;&#x5E38;&#x8017;&#x65F6;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x80FD;&#x5728;zygote&#x91CC;&#x5C31;&#x7ED9;&#x8FD9;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x521D;&#x59CB;&#x5316;&#x5DE5;&#x4F5C;&#x505A;&#x597D;&#xFF0C;&#x5B50;&#x8FDB;&#x7A0B;&#x5728;fork&#x7684;&#x65F6;&#x5019;&#x5C31;&#x80FD;<strong>&#x76F4;&#x63A5;&#x5171;&#x4EAB;</strong>&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x6837;&#x7684;&#x8BDD;&#x6548;&#x7387;&#x5C31;&#x4F1A;&#x975E;&#x5E38;&#x9AD8;&#x3002;&#x8FD9;&#x4E2A;&#x5C31;&#x662F;zygote&#x5B58;&#x5728;&#x7684;&#x4EF7;&#x503C;&#xFF0C;&#x8FD9;&#x4E00;&#x70B9;&#x5462;SystemServer&#x662F;&#x66FF;&#x4EE3;&#x4E0D;&#x4E86;&#x7684;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x56E0;&#x4E3A;SystemServer&#x91CC;&#x8DD1;&#x4E86;<strong>&#x4E00;&#x5806;&#x7CFB;&#x7EDF;&#x670D;&#x52A1;&#xFF0C;&#x8FD9;&#x4E9B;&#x662F;&#x4E0D;&#x80FD;&#x7EE7;&#x627F;&#x5230;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;</strong>&#x3002;</p>
<p>&#x5185;&#x5B58;&#x89D2;&#x5EA6;&#xFF1A;
-<font color="red">&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5728;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x9664;&#x4E86;&#x5FC5;&#x8981;&#x7684;&#x8D44;&#x6E90;&#x5916;&#xFF0C;&#x6700;&#x597D;&#x662F;&#x5E72;&#x5E72;&#x51C0;&#x51C0;&#x7684;</font>&#xFF0C;&#x4E0D;&#x8981;&#x7EE7;&#x627F;&#x4E00;&#x5806;&#x4E71;&#x4E03;&#x516B;&#x7CDF;&#x7684;&#x4E1C;&#x897F;&#x3002;&#x6240;&#x4EE5;&#x5462;&#xFF0C;&#x4E0D;&#x5982;&#x7ED9;SystemServer&#x548C;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x91CC;&#x90FD;&#x8981;&#x7528;&#x5230;&#x7684;&#x8D44;&#x6E90;&#x62BD;&#x51FA;&#x6765;&#x5355;&#x72EC;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x91CC;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8FD9;&#x7684;zygote&#x8FDB;&#x7A0B;&#xFF0C;&#x7136;&#x540E;zygote&#x8FDB;&#x7A0B;&#x518D;&#x5206;&#x522B;&#x5B75;&#x5316;&#x51FA;SystemServer&#x8FDB;&#x7A0B;&#x548C;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x3002;&#x5B75;&#x5316;&#x51FA;&#x6765;&#x4E4B;&#x540E;&#xFF0C;SystemServer&#x8FDB;&#x7A0B;&#x548C;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x5C31;&#x53EF;&#x4EE5;&#x5404;&#x5E72;&#x5404;&#x7684;&#x4E8B;&#x4E86;&#x3002;
&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="https://blog.csdn.net/m0_37999066/article/details/127271879" target="_blank">https://blog.csdn.net/m0_37999066/article/details/127271879</a></p>
<p>&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x89D2;&#x5EA6;&#xFF1A;</p>
<blockquote>
<p>&#x62BD;&#x8C61;&#x7C7B;&#xFF1A;zygote&#x4F5C;&#x4E3A;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x7684;<font color="red">&#x62BD;&#x8C61;&#x7956;&#x5148;</font>&#xFF08;&#x5171;&#x4EAB;&#x5F88;&#x591A;&#x5171;&#x540C;&#x8D44;&#x6E90;&#xFF0C;&#x4E0D;&#x7528;&#x91CD;&#x65B0;&#x52A0;&#x8F7D;&#x6BD4;&#x5982;&#x7C7B;&#xFF09;</p>
</blockquote>
<p>TODO&#xFF1A;</p>
<p>&#x80FD;&#x4E0D;&#x80FD;&#x5148;&#x8D77;&#x51E0;&#x4E2A;&#x7A7A;&#x8FDB;&#x7A0B;&#xFF1F;</p>
<p>---------------&gt; &#x6027;&#x80FD;&#x4F18;&#x5316;&#xFF0C;&#x771F;&#x7684;&#x5C31;&#x8FD9;&#x4E48;&#x505A;&#x4E86;</p>
<h3 id="&#x65E2;&#x7136;zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709;-zygote&#xFF1F;"><a name="&#x65E2;&#x7136;zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709;-zygote&#xFF1F;" class="anchor-navigation-ex-anchor" href="#&#x65E2;&#x7136;zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709;-zygote&#xFF1F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.18.2. &#x65E2;&#x7136;Zygote&#x5FC5;&#x8981;&#xFF0C;linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709; Zygote&#xFF1F;</h3>
<p><strong>Zygote&#x7684;&#x672C;&#x8D28;&#x529F;&#x80FD;&#x5C31;&#x662F;linux&#x7684;fork</strong></p>
<p>linux&#x7CFB;&#x7EDF;&#x4E3A;&#x5565;&#x5C31;&#x6CA1;&#x6709; Zygote&#xFF1F;-------------&gt;  &#x56E0;&#x4E3A;linux&#xFF0C;<strong>&#x4E0D;&#x9700;&#x8981;  &#x542F;&#x52A8;&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x52A0;&#x8F7D;&#x5404;&#x7C7B;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;</strong></p>
<h3 id="zygote&#x7684;ipc&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;"><a name="zygote&#x7684;ipc&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;" class="anchor-navigation-ex-anchor" href="#zygote&#x7684;ipc&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.18.3. Zygote&#x7684;IPC&#x901A;&#x4FE1;&#x673A;&#x5236;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x91C7;&#x7528;binder&#xFF1F;&#x5982;&#x679C;&#x91C7;&#x7528;binder&#x7684;&#x8BDD;&#x4F1A;&#x6709;&#x4EC0;&#x4E48;&#x95EE;&#x9898;&#x4E48;&#xFF1F;</h3>
<p>&#x539F;&#x6587;&#x94FE;&#x63A5;&#xFF1A;<a href="https://blog.csdn.net/m0_37999066/article/details/127271879" target="_blank">https://blog.csdn.net/m0_37999066/article/details/127271879</a></p>
<p>&#x9AD8;&#x9891;&#x8003;&#x70B9;</p>
<h2 id="&#x53C2;&#x8003;"><a name="&#x53C2;&#x8003;" class="anchor-navigation-ex-anchor" href="#&#x53C2;&#x8003;"><i class="fa fa-link" aria-hidden="true"></i></a>2.19. &#x53C2;&#x8003;</h2>
<p><a href="https://blog.csdn.net/hzwailll/article/details/85339714" target="_blank">https://blog.csdn.net/hzwailll/article/details/85339714</a>      ActivityThread&#x7684;&#x7406;&#x89E3;&#x548C;APP&#x7684;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;</p>
<h1 id="linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;"><a name="linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;" class="anchor-navigation-ex-anchor" href="#linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;"><i class="fa fa-link" aria-hidden="true"></i></a>3. linux&#x542F;&#x52A8;&#x8FC7;&#x7A0B;-----&#x8BE6;&#x89E3;</h1>
<p>&#x53C2;&#x8003;&#xFF1A; <a href="https://blog.csdn.net/weixin_43976122/article/details/128961694" target="_blank">https://blog.csdn.net/weixin_43976122/article/details/128961694</a></p>
<p><img src="InitSystem.assets/20180813200804839" alt="img"></p>
<p>&#x53C2;&#x8003;&#xFF1A;</p>
<p><a href="https://blog.csdn.net/whatday/article/details/100759678" target="_blank">https://blog.csdn.net/whatday/article/details/100759678</a></p>
<h2 id="todo&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;"><a name="todo&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;" class="anchor-navigation-ex-anchor" href="#todo&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;"><i class="fa fa-link" aria-hidden="true"></i></a>3.1. TODO&#xFF1A;&#x5982;&#x4F55;&#x624B;&#x52A8;&#x628A;init&#x8FDB;&#x7A0B;&#x62C9;&#x8D77;&#x6765;&#xFF1F;&#xFF08;&#x6E90;&#x7801;&#x89D2;&#x5EA6;&#x3001;&#x7CFB;&#x7EDF;&#x8FD0;&#x884C;&#x65F6;&#x6587;&#x4EF6;&#x89D2;&#x5EA6;&#xFF09;</h2>
<blockquote>
<p>---------&gt;  1&#x3001;&#x7814;&#x7A76;deploy  2&#x3001;&#x95EE;&#x5F20;&#x3001;jueyu</p>
<p><a href="https://serverfault.com/questions/462821/how-do-i-run-a-debian-init-d-script-manually-not-at-boot" target="_blank">https://serverfault.com/questions/462821/how-do-i-run-a-debian-init-d-script-manually-not-at-boot</a>       <a href="https://serverfault.com/questions/462821/how-do-i-run-a-debian-init-d-script-manually-not-at-boot" target="_blank">How do I run a Debian init.d script manually, not at boot?</a></p>
</blockquote>
<p><a href="https://blog.csdn.net/mostone/article/details/99659822" target="_blank">https://blog.csdn.net/mostone/article/details/99659822</a></p>
<p><img src="InitSystem.assets/image-20231021055244587.png" alt="image-20231021055244587"></p>
<p><img src="InitSystem.assets/image-20231021055348456.png" alt="image-20231021055348456"></p>

<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: 关键流程">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="startAPP.html" class="navigation navigation-next " aria-label="Next page: Start APP">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Init System","level":"1.5.1.1","depth":3,"next":{"title":"Start APP","level":"1.5.1.2","depth":3,"path":"Andriod/关键流程/startAPP.md","ref":"Andriod/关键流程/startAPP.md","articles":[]},"previous":{"title":"关键流程","level":"1.5.1","depth":2,"path":"Andriod/关键流程/README.md","ref":"Andriod/关键流程/README.md","articles":[{"title":"Init System","level":"1.5.1.1","depth":3,"path":"Andriod/关键流程/InitSystem.md","ref":"Andriod/关键流程/InitSystem.md","articles":[]},{"title":"Start APP","level":"1.5.1.2","depth":3,"path":"Andriod/关键流程/startAPP.md","ref":"Andriod/关键流程/startAPP.md","articles":[]}]},"dir":"ltr"},"config":{"//":["这是多行注释：    anchor-navigation-ex 是","anchor-navigation-ex 是","click-reveal 本地使用ok，但是github在build pages时，不识别click-reveal","accordion 也是折叠代码段","anchor-navigation-ex 是"],"plugins":["anchor-navigation-ex","toggle-chapters","expandable-chapters-small","splitter","code","page-treeview","popup","-search","-lunr","sidebar-style","auto-scroll-table","click-reveal","accordion","pageview-count","search-pro","prism","prism-themes","-highlight"],"root":"./markdownsFiles","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"sidebar-style":{"author":"Kent","title":"《prove》"},"tbfed-pagefooter":{"copyright":"Copyright &copy ershouche-FE 2019","modify_label":"文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"page-treeview":{"collapsed":false,"copyright":"Copyright © aleen42","minHeaderCount":"1","minHeaderDeep":"1"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"],"lang":{"flow":"typescript"},"ignore":["mermaid","eval-js"]},"disqus":{"shortName":"gitbookuse"},"splitter":{},"search-pro":{},"accordion":{},"auto-scroll-table":{},"popup":{},"lunr":{"maxIndexSize":400000},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"click-reveal":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"pageview-count":{},"prism-themes":{},"expandable-chapters-small":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"bookname":"笔记","variables":{},"title":"Kent的博客","gitbook":"*"},"file":{"path":"Andriod/关键流程/InitSystem.md","mtime":"2023-12-04T16:51:54.959Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-06-30T04:49:43.062Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sidebar-style/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-auto-scroll-table/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-click-reveal/click_reveal.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-pageview-count/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

